{"remainingRequest":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\components\\speak\\SpeakMask.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\components\\speak\\SpeakMask.vue","mtime":1540735191000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHJlYWxQeCB9IGZyb20gJ0AvdXRpbHMvdXRpbHMnCgpleHBvcnQgZGVmYXVsdCB7CiAgcHJvcHM6IHsKICAgIHRpdGxlOiBTdHJpbmcsCiAgICBib29rOiBPYmplY3QsCiAgICBzZWN0aW9uOiBPYmplY3QsCiAgICBjdXJyZW50U2VjdGlvbkluZGV4OiBOdW1iZXIsCiAgICBjdXJyZW50U2VjdGlvblRvdGFsOiBOdW1iZXIsCiAgICBpc1BsYXlpbmc6IEJvb2xlYW4sCiAgICBwbGF5SW5mbzogT2JqZWN0CiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdmlzaWJsZTogZmFsc2UsCiAgICAgIHNwZWFrQ2FyZFZpc2libGU6IGZhbHNlLAogICAgICBwcm9ncmVzczogMCwKICAgICAgcmVhZEhlaWdodDogMAogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgcmVmcmVzaFByb2dyZXNzKHApIHsKICAgICAgdGhpcy5wcm9ncmVzcyA9IHAKICAgICAgdGhpcy4kcmVmcy5wcm9ncmVzcy5zdHlsZS5iYWNrZ3JvdW5kU2l6ZSA9IGAke3RoaXMucHJvZ3Jlc3N9JSAxMDAlYAogICAgfSwKICAgIHVwZGF0ZVRleHQocHJvbWlzZSkgewogICAgICBwcm9taXNlLnRoZW4oKCkgPT4gewogICAgICAgIGNvbnN0IGN1cnJlbnRQYWdlID0gdGhpcy5yZW5kaXRpb24uY3VycmVudExvY2F0aW9uKCkKICAgICAgICBjb25zdCBjZmliYXNlID0gdGhpcy5zZWN0aW9uLmNmaUJhc2UKICAgICAgICBjb25zdCBjZmlzdGFydCA9IGN1cnJlbnRQYWdlLnN0YXJ0LmNmaS5yZXBsYWNlKC8uKiEvLCAnJykucmVwbGFjZSgvXCkvLCAnJykKICAgICAgICBjb25zdCBjZmllbmQgPSBjdXJyZW50UGFnZS5lbmQuY2ZpLnJlcGxhY2UoLy4qIS8sICcnKS5yZXBsYWNlKC9cKS8sICcnKQogICAgICAgIHRoaXMuYm9vay5nZXRSYW5nZShgZXB1YmNmaSgke2NmaWJhc2V9ISwke2NmaXN0YXJ0fSwke2NmaWVuZH0pYCkudGhlbihyYW5nZSA9PiB7CiAgICAgICAgICBsZXQgdGV4dCA9IHJhbmdlLnRvU3RyaW5nKCkKICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xzKDIsKS9nLCAnJykKICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xyL2csICcnKQogICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXG4vZywgJycpCiAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cdC9nLCAnJykKICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xmL2csICcnKQogICAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlVGV4dCcsIHRleHQpCiAgICAgICAgfSkKICAgICAgfSkKICAgIH0sCiAgICB0b2dnbGVQbGF5KCkgewogICAgICB0aGlzLiRwYXJlbnQudG9nZ2xlUGxheSgpCiAgICB9LAogICAgcHJldigpIHsKICAgICAgaWYgKHRoaXMuY3VycmVudFNlY3Rpb25JbmRleCA+IDEpIHsKICAgICAgICB0aGlzLnVwZGF0ZVRleHQodGhpcy5yZW5kaXRpb24ucHJldigpKQogICAgICAgIHRoaXMuJGVtaXQoJ3VwZGF0ZTpjdXJyZW50U2VjdGlvbkluZGV4JywgdGhpcy5jdXJyZW50U2VjdGlvbkluZGV4IC0gMSkKICAgICAgICB0aGlzLiRwYXJlbnQucmVzZXRQbGF5KCkKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHRoaXMuJHBhcmVudC50b2dnbGVQbGF5KCkKICAgICAgICB9LCA1MDApCiAgICAgIH0KICAgIH0sCiAgICBuZXh0KCkgewogICAgICBpZiAodGhpcy5jdXJyZW50U2VjdGlvbkluZGV4IDwgdGhpcy5jdXJyZW50U2VjdGlvblRvdGFsKSB7CiAgICAgICAgdGhpcy51cGRhdGVUZXh0KHRoaXMucmVuZGl0aW9uLm5leHQoKSkKICAgICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6Y3VycmVudFNlY3Rpb25JbmRleCcsIHRoaXMuY3VycmVudFNlY3Rpb25JbmRleCArIDEpCiAgICAgICAgdGhpcy4kcGFyZW50LnJlc2V0UGxheSgpCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICB0aGlzLiRwYXJlbnQudG9nZ2xlUGxheSgpCiAgICAgICAgfSwgNTAwKQogICAgICB9CiAgICB9LAogICAgZGlzcGxheSgpIHsKICAgICAgaWYgKCF0aGlzLnJlbmRpdGlvbikgewogICAgICAgIHRoaXMucmVuZGl0aW9uID0gdGhpcy5ib29rLnJlbmRlclRvKCdib29rLXJlYWQnLCB7CiAgICAgICAgICB3aWR0aDogd2luZG93LmlubmVyV2lkdGggPiA2NDAgPyA2NDAgOiB3aW5kb3cuaW5uZXJXaWR0aCwKICAgICAgICAgIGhlaWdodDogdGhpcy5yZWFkSGVpZ2h0LAogICAgICAgICAgbWV0aG9kOiAnZGVmYXVsdCcKICAgICAgICB9KQogICAgICAgIHRoaXMuZGlzcGxheWVkID0gdGhpcy5yZW5kaXRpb24uZGlzcGxheSh0aGlzLnNlY3Rpb24uaHJlZikKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRpc3BsYXllZCA9IHRoaXMucmVuZGl0aW9uLmRpc3BsYXkodGhpcy5zZWN0aW9uLmhyZWYpCiAgICAgIH0KICAgIH0sCiAgICBvblByb2dyZXNzQ2hhbmdlKHByb2dyZXNzKSB7CiAgICB9LAogICAgb25Qcm9ncmVzc0lucHV0KHByb2dyZXNzKSB7CiAgICAgIHRoaXMucHJvZ3Jlc3MgPSBwcm9ncmVzcwogICAgICB0aGlzLiRyZWZzLnByb2dyZXNzLnN0eWxlLmJhY2tncm91bmRTaXplID0gYCR7dGhpcy5wcm9ncmVzc30lIDEwMCVgCiAgICB9LAogICAgaGlkZSgpIHsKICAgICAgdGhpcy5zcGVha0NhcmRWaXNpYmxlID0gZmFsc2UKICAgICAgdGhpcy52aXNpYmxlID0gZmFsc2UKICAgIH0sCiAgICBzaG93KCkgewogICAgICB0aGlzLnZpc2libGUgPSB0cnVlCiAgICAgIHRoaXMuc3BlYWtDYXJkVmlzaWJsZSA9IHRydWUKICAgICAgdGhpcy5yZWZyZXNoKCkKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgIHRoaXMuZGlzcGxheSgpCiAgICAgIH0pCiAgICB9LAogICAgcmVmcmVzaCgpIHsKICAgICAgdGhpcy5yZWFkSGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0ICogMC45IC0gcmVhbFB4KDQwKSAtIHJlYWxQeCg1NCkgLSByZWFsUHgoNDYpIC0gcmVhbFB4KDQ4KSAtIHJlYWxQeCg2MCkgLSByZWFsUHgoNDQpCiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMucmVhZEhlaWdodCkKICAgICAgdGhpcy4kcmVmcy5ib29rV3JhcHBlci5zdHlsZS5oZWlnaHQgPSB0aGlzLnJlYWRIZWlnaHQgKyAncHgnCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["SpeakMask.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgFA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SpeakMask.vue","sourceRoot":"src/components/speak","sourcesContent":["<template>\n  <transition name=\"fade\">\n    <div class=\"book-speak-mask-wrapper\" @click.stop.prevent=\"hide\" v-show=\"visible\">\n      <transition name=\"popup-slide-up\">\n        <div class=\"book-speak-mask-card-wrapper\" v-show=\"speakCardVisible\" @click.stop.prevent=\"hide\">\n          <div class=\"pulldown-icon-wrapper\" @click=\"hide\">\n            <span class=\"icon-pull_down\"></span>\n          </div>\n          <div class=\"card-title-wrapper\">\n            <div class=\"icon-speak-wrapper\">\n              <span class=\"icon-speak\"></span>\n            </div>\n            <div class=\"speak-title-wrapper\">\n              <span class=\"speak-title\">{{$t('speak.voice')}}</span>\n            </div>\n            <div class=\"read-fulltext-wrapper\">\n              <span class=\"read-fulltext\">{{$t('speak.read')}}</span>\n            </div>\n          </div>\n          <div class=\"card-section-title-wrapper\">\n            <div class=\"card-section-title-text\">{{title}}</div>\n            <div class=\"card-section-sub-title-text\" v-if=\"currentSectionIndex\">{{currentSectionIndex}} /\n              {{currentSectionTotal}}\n            </div>\n          </div>\n          <div class=\"setting-progress\">\n            <div class=\"progress-wrapper\">\n              <input class=\"progress\" type=\"range\"\n                     max=\"100\"\n                     min=\"0\"\n                     step=\"1\"\n                     @change=\"onProgressChange($event.target.value)\"\n                     @input=\"onProgressInput($event.target.value)\"\n                     :value=\"progress\"\n                     ref=\"progress\">\n            </div>\n            <div class=\"progress-text\">\n              <div class=\"progress-text-current\">{{playInfo ? playInfo.currentMinute : '00'}}:{{playInfo ?\n                playInfo.currentSecond : '00'}}\n              </div>\n              <div class=\"progress-text-left\">-{{playInfo ? playInfo.leftMinute : '00'}}:{{playInfo ?\n                playInfo.leftSecond : '00'}}\n              </div>\n            </div>\n          </div>\n          <div class=\"playing-wrapper\">\n            <div class=\"icon-settings-wrapper\">\n              <span class=\"icon-settings\"></span>\n              <div class=\"settings-text\">{{$t('speak.settings')}}</div>\n            </div>\n            <span class=\"icon-play_backward\" :class=\"{'not-use': currentSectionIndex <= 1}\" @click.stop.prevent=\"prev\"></span>\n            <div class=\"icon-play-wrapper\" @click.stop.prevent=\"togglePlay\">\n              <span class=\"icon-play_go\" v-if=\"!isPlaying\"></span>\n              <span class=\"icon-play_pause\" v-else></span>\n            </div>\n            <span class=\"icon-play_forward\" :class=\"{'not-use': currentSectionIndex >= currentSectionTotal}\"\n                  @click.stop.prevent=\"next\"></span>\n            <div class=\"icon-clock-wrapper\">\n              <span class=\"icon-clock\"></span>\n              <div class=\"clock-text\">{{$t('speak.timing')}}</div>\n            </div>\n          </div>\n          <div class=\"read-apply-wrapper\">\n            {{$t('speak.apply')}}\n          </div>\n          <div class=\"read-title-wrapper\">\n            <span class=\"line\"></span>\n            <div class=\"read-title-text\">{{$t('speak.current')}}</div>\n            <span class=\"line\"></span>\n          </div>\n          <div class=\"book-wrapper\" ref=\"bookWrapper\">\n            <div id=\"book-read\"></div>\n          </div>\n        </div>\n      </transition>\n    </div>\n  </transition>\n</template>\n\n<script>\n  import { realPx } from '@/utils/utils'\n\n  export default {\n    props: {\n      title: String,\n      book: Object,\n      section: Object,\n      currentSectionIndex: Number,\n      currentSectionTotal: Number,\n      isPlaying: Boolean,\n      playInfo: Object\n    },\n    data() {\n      return {\n        visible: false,\n        speakCardVisible: false,\n        progress: 0,\n        readHeight: 0\n      }\n    },\n    methods: {\n      refreshProgress(p) {\n        this.progress = p\n        this.$refs.progress.style.backgroundSize = `${this.progress}% 100%`\n      },\n      updateText(promise) {\n        promise.then(() => {\n          const currentPage = this.rendition.currentLocation()\n          const cfibase = this.section.cfiBase\n          const cfistart = currentPage.start.cfi.replace(/.*!/, '').replace(/\\)/, '')\n          const cfiend = currentPage.end.cfi.replace(/.*!/, '').replace(/\\)/, '')\n          this.book.getRange(`epubcfi(${cfibase}!,${cfistart},${cfiend})`).then(range => {\n            let text = range.toString()\n            text = text.replace(/\\s(2,)/g, '')\n            text = text.replace(/\\r/g, '')\n            text = text.replace(/\\n/g, '')\n            text = text.replace(/\\t/g, '')\n            text = text.replace(/\\f/g, '')\n            this.$emit('updateText', text)\n          })\n        })\n      },\n      togglePlay() {\n        this.$parent.togglePlay()\n      },\n      prev() {\n        if (this.currentSectionIndex > 1) {\n          this.updateText(this.rendition.prev())\n          this.$emit('update:currentSectionIndex', this.currentSectionIndex - 1)\n          this.$parent.resetPlay()\n          setTimeout(() => {\n            this.$parent.togglePlay()\n          }, 500)\n        }\n      },\n      next() {\n        if (this.currentSectionIndex < this.currentSectionTotal) {\n          this.updateText(this.rendition.next())\n          this.$emit('update:currentSectionIndex', this.currentSectionIndex + 1)\n          this.$parent.resetPlay()\n          setTimeout(() => {\n            this.$parent.togglePlay()\n          }, 500)\n        }\n      },\n      display() {\n        if (!this.rendition) {\n          this.rendition = this.book.renderTo('book-read', {\n            width: window.innerWidth > 640 ? 640 : window.innerWidth,\n            height: this.readHeight,\n            method: 'default'\n          })\n          this.displayed = this.rendition.display(this.section.href)\n        } else {\n          this.displayed = this.rendition.display(this.section.href)\n        }\n      },\n      onProgressChange(progress) {\n      },\n      onProgressInput(progress) {\n        this.progress = progress\n        this.$refs.progress.style.backgroundSize = `${this.progress}% 100%`\n      },\n      hide() {\n        this.speakCardVisible = false\n        this.visible = false\n      },\n      show() {\n        this.visible = true\n        this.speakCardVisible = true\n        this.refresh()\n        this.$nextTick(() => {\n          this.display()\n        })\n      },\n      refresh() {\n        this.readHeight = window.innerHeight * 0.9 - realPx(40) - realPx(54) - realPx(46) - realPx(48) - realPx(60) - realPx(44)\n        // console.log(this.readHeight)\n        this.$refs.bookWrapper.style.height = this.readHeight + 'px'\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\" rel=\"stylesheet/scss\" scoped>\n  @import \"../../assets/styles/global\";\n\n  .book-speak-mask-wrapper {\n    position: fixed;\n    left: 0;\n    top: 0;\n    z-index: 120;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, .5);\n    .book-speak-mask-card-wrapper {\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      z-index: 120;\n      width: 100%;\n      height: 90%;\n      background: white;\n      border-radius: px2rem(10) px2rem(10) 0 0;\n      .pulldown-icon-wrapper {\n        width: 100%;\n        height: px2rem(40);\n        color: #ccc;\n        font-size: px2rem(40);\n        @include center;\n      }\n      .card-title-wrapper {\n        width: 100%;\n        height: px2rem(54);\n        display: flex;\n        padding: 0 px2rem(15);\n        box-sizing: border-box;\n        .icon-speak-wrapper {\n          flex: 0 0 px2rem(40);\n          @include left;\n          .icon-speak {\n            font-size: px2rem(24);\n            color: #999;\n          }\n        }\n        .speak-title-wrapper {\n          flex: 1;\n          @include left;\n          .speak-title {\n            font-size: px2rem(16);\n            font-weight: bold;\n            color: #666;\n          }\n        }\n        .read-fulltext-wrapper {\n          flex: 1;\n          @include right;\n          .read-fulltext {\n            font-size: px2rem(12);\n            font-weight: bold;\n            color: $color-blue;\n            background: rgba(74, 171, 255, .2);\n            padding: px2rem(5) px2rem(10);\n            box-sizing: border-box;\n            border-radius: px2rem(20);\n          }\n        }\n      }\n      .card-section-title-wrapper {\n        width: 100%;\n        height: px2rem(46);\n        padding: 0 px2rem(15);\n        box-sizing: border-box;\n        @include columnCenter;\n        .card-section-title-text {\n          font-size: px2rem(16);\n          color: #333;\n          font-weight: bold;\n        }\n        .card-section-sub-title-text {\n          font-size: px2rem(12);\n          color: #666;\n          margin-top: px2rem(5);\n        }\n      }\n      .setting-progress {\n        width: 100%;\n        height: px2rem(48);\n        @include columnTop;\n        .progress-wrapper {\n          flex: 1;\n          width: 100%;\n          @include center;\n          padding: 0 px2rem(30);\n          box-sizing: border-box;\n          .progress {\n            width: 100%;\n            -webkit-appearance: none;\n            height: px2rem(2);\n            background: -webkit-linear-gradient($color-blue, $color-blue) no-repeat, rgba(74, 171, 255, .2);\n            background-size: 0 100%;\n            &:focus {\n              outline: none;\n            }\n            &::-webkit-slider-thumb {\n              -webkit-appearance: none;\n              height: px2rem(20);\n              width: px2rem(20);\n              border-radius: 50%;\n              background: $color-blue;\n              border: none;\n              box-shadow: 0 4px 4px 0 rgba(0, 0, 0, .15);\n            }\n          }\n        }\n        .progress-text {\n          display: flex;\n          width: 100%;\n          padding: 0 px2rem(30);\n          box-sizing: border-box;\n          .progress-text-current {\n            flex: 1;\n            text-align: left;\n            font-size: px2rem(10);\n            color: #666;\n          }\n          .progress-text-left {\n            flex: 1;\n            text-align: right;\n            font-size: px2rem(10);\n            color: #666;\n          }\n        }\n      }\n      .playing-wrapper {\n        width: 100%;\n        height: px2rem(60);\n        @include center;\n        .icon-settings-wrapper {\n          flex: 1;\n          @include columnCenter;\n          .icon-settings {\n            font-size: px2rem(18);\n            color: #666;\n          }\n          .settings-text {\n            margin-top: px2rem(5);\n            font-size: px2rem(10);\n            color: #666;\n          }\n        }\n        .icon-play_backward {\n          font-size: px2rem(30);\n          color: $color-blue;\n          &:active {\n            opacity: .5;\n          }\n          &.not-use {\n            color: $color-blue-transparent;\n          }\n        }\n        .icon-play-wrapper {\n          flex: 0 0 px2rem(100);\n          @include center;\n          &:active {\n            opacity: .5;\n          }\n          .icon-play_go {\n            font-size: px2rem(50);\n            color: $color-blue;\n          }\n          .icon-play_pause {\n            font-size: px2rem(50);\n            color: $color-blue;\n          }\n        }\n        .icon-play_forward {\n          font-size: px2rem(30);\n          color: $color-blue;\n          &:active {\n            opacity: .5;\n          }\n          &.not-use {\n            color: $color-blue-transparent;\n          }\n        }\n        .icon-clock-wrapper {\n          flex: 1;\n          @include columnCenter;\n          .icon-clock2 {\n            font-size: px2rem(18);\n            color: #666;\n          }\n          .clock-text {\n            margin-top: px2rem(5);\n            font-size: px2rem(10);\n            color: #666;\n          }\n        }\n      }\n      .read-apply-wrapper {\n        width: 100%;\n        height: px2rem(20);\n        font-size: px2rem(10);\n        color: $color-green;\n        @include center;\n      }\n      .read-title-wrapper {\n        width: 100%;\n        height: px2rem(24);\n        box-sizing: border-box;\n        @include center;\n        .line {\n          flex: 1;\n          border-top: px2rem(1) solid #eee;\n          height: 0;\n        }\n        .read-title-text {\n          flex: 0 0 px2rem(130);\n          font-size: px2rem(14);\n          color: #666;\n          text-align: center;\n        }\n      }\n      .book-wrapper {\n        #read {\n          width: 100%;\n          height: 100%;\n        }\n      }\n    }\n  }\n</style>\n"]}]}