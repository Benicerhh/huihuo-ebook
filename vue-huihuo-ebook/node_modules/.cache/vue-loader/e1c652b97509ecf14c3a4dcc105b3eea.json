{"remainingRequest":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\views\\store\\StoreList.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\views\\store\\StoreList.vue","mtime":1589118766795},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBEZXRhaWxUaXRsZSBmcm9tICcuLi8uLi9jb21wb25lbnRzL2RldGFpbC9EZXRhaWxUaXRsZScKaW1wb3J0IFNjcm9sbCBmcm9tICcuLi8uLi9jb21wb25lbnRzL2NvbW1vbi9TY3JvbGwnCmltcG9ydCBGZWF0dXJlZCBmcm9tICcuLi8uLi9jb21wb25lbnRzL2hvbWUvRmVhdHVyZWQnCmltcG9ydCB7IHJlYWxQeCB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWxzJwppbXBvcnQgeyBsaXN0IH0gZnJvbSAnLi4vLi4vYXBpL3N0b3JlJwppbXBvcnQgeyBjYXRlZ29yeUxpc3QsIGNhdGVnb3J5VGV4dCB9IGZyb20gJy4uLy4uL3V0aWxzL3N0b3JlJwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIERldGFpbFRpdGxlLAogICAgU2Nyb2xsLAogICAgRmVhdHVyZWQKICB9LAogIGNvbXB1dGVkOiB7CiAgICAvLyDliqjmgIHnlJ/miJDmoIfpopjmlbDmja4KICAgIHRpdGxlKCkgewogICAgICBpZiAodGhpcy5saXN0KSB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgIHRoaXMudG90YWwgJiYgdGhpcy4kdCgnaG9tZS5hbGxCb29rJykucmVwbGFjZSgnJDEnLCB0aGlzLnRvdGFsTnVtYmVyKQogICAgICAgICkKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbAogICAgICB9CiAgICB9LAogICAgLy8g6I635Y+W5b2T5YmN5YiX6KGo5Lit55S15a2Q5Lmm5oC75pWwCiAgICB0b3RhbE51bWJlcigpIHsKICAgICAgbGV0IG51bSA9IDAKICAgICAgT2JqZWN0LmtleXModGhpcy5saXN0KS5mb3JFYWNoKGtleSA9PiB7CiAgICAgICAgbnVtICs9IHRoaXMubGlzdFtrZXldLmxlbmd0aAogICAgICB9KQogICAgICByZXR1cm4gbnVtCiAgICB9CiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbGlzdDogbnVsbCwKICAgICAgdG90YWw6IG51bGwKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIC8vIOiOt+WPluWIhuexu+aWh+acrAogICAgZ2V0Q2F0ZWdvcnlUZXh0KGtleSkgewogICAgICByZXR1cm4gYCR7Y2F0ZWdvcnlUZXh0KGNhdGVnb3J5TGlzdFtrZXldLCB0aGlzKX0oJHsKICAgICAgICB0aGlzLmxpc3Rba2V5XS5sZW5ndGgKICAgICAgfSlgCiAgICB9LAogICAgYmFjaygpIHsKICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKQogICAgfSwKICAgIC8vIOagh+mimOmYtOW9seeahOmakOiXj+eKtuaAgQogICAgb25TY3JvbGwob2Zmc2V0WSkgewogICAgICBpZiAob2Zmc2V0WSA+IHJlYWxQeCg0MikpIHsKICAgICAgICB0aGlzLiRyZWZzLnRpdGxlLnNob3dTaGFkb3coKQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJHJlZnMudGl0bGUuaGlkZVNoYWRvdygpCiAgICAgIH0KICAgIH0sCiAgICAvLyDpgJrov4dBUEnojrflj5bliIbnsbvliJfooagKICAgIGdldExpc3QoKSB7CiAgICAgIGxpc3QoKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICB0aGlzLmxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEKICAgICAgICB0aGlzLnRvdGFsID0gcmVzcG9uc2UuZGF0YS50b3RhbAogICAgICAgIGNvbnN0IGNhdGVnb3J5ID0gdGhpcy4kcm91dGUucXVlcnkuY2F0ZWdvcnkKICAgICAgICBjb25zdCBrZXl3b3JkID0gdGhpcy4kcm91dGUucXVlcnkua2V5d29yZAogICAgICAgIGlmIChjYXRlZ29yeSkgewogICAgICAgICAgLy8g5aaC5p6c55So5oi35Lyg5YWl5LqG5YiG57G75pWw5o2u77yM5YiZ5LuO57uT5p6c5Lit5pCc57Si55u45bqU55qE5YiG57G75pWw5o2u5bm26L+b6KGM5bGV56S6CiAgICAgICAgICBjb25zdCBrZXkgPSBPYmplY3Qua2V5cyh0aGlzLmxpc3QpLmZpbHRlcigKICAgICAgICAgICAgaXRlbSA9PiBpdGVtID09PSBjYXRlZ29yeQogICAgICAgICAgKVswXQogICAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMubGlzdFtrZXldCiAgICAgICAgICB0aGlzLmxpc3QgPSB7fQogICAgICAgICAgdGhpcy5saXN0W2tleV0gPSBkYXRhCiAgICAgICAgfSBlbHNlIGlmIChrZXl3b3JkKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnc2VhcmNoIGluZycpCiAgICAgICAgICAvLyDlpoLmnpznlKjmiLfovpPlhaXkuoblhbPplK7lrZfvvIzliJnpgJrov4fkuablkI3ov5vooYzlhbPplK7lrZfljLnphY3vvIjmkJzntKLnrpfms5XvvIkKICAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMubGlzdCkuZmlsdGVyKGtleSA9PiB7CiAgICAgICAgICAgIHRoaXMubGlzdFtrZXldID0gdGhpcy5saXN0W2tleV0uZmlsdGVyKAogICAgICAgICAgICAgIGJvb2sgPT4gYm9vay5maWxlTmFtZS5pbmRleE9mKGtleXdvcmQpID49IDAKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gdGhpcy5saXN0W2tleV0ubGVuZ3RoID4gMAogICAgICAgICAgfSkKICAgICAgICB9CiAgICAgIH0pCiAgICB9CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5nZXRMaXN0KCkKICAgIHRoaXMudGl0bGVUZXh0ID0gdGhpcy4kcm91dGUucXVlcnkuY2F0ZWdvcnlUZXh0CiAgfQp9Cg=="},{"version":3,"sources":["StoreList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAsBA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"StoreList.vue","sourceRoot":"src/views/store","sourcesContent":["<!-- 书城列表组件 -->\r\n<template>\r\n  <div class=\"book-list-wrapper\">\r\n    <detail-title :title=\"title\" :showShelf=\"true\" @back=\"back\" ref=\"title\"></detail-title>\r\n    <scroll\r\n      class=\"book-list-scroll-wrapper\"\r\n      :top=\"42\"\r\n      @onScroll=\"onScroll\"\r\n      ref=\"scroll\"\r\n    >\r\n      <featured\r\n        :data=\"value\"\r\n        :titleText=\"titleText ? titleText : getCategoryText(key)\"\r\n        :btnText=\"''\"\r\n        v-for=\"(value, key, index) in list\"\r\n        :key=\"index\"\r\n      ></featured>\r\n    </scroll>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import DetailTitle from '../../components/detail/DetailTitle'\r\n  import Scroll from '../../components/common/Scroll'\r\n  import Featured from '../../components/home/Featured'\r\n  import { realPx } from '../../utils/utils'\r\n  import { list } from '../../api/store'\r\n  import { categoryList, categoryText } from '../../utils/store'\r\n\r\n  export default {\r\n    components: {\r\n      DetailTitle,\r\n      Scroll,\r\n      Featured\r\n    },\r\n    computed: {\r\n      // 动态生成标题数据\r\n      title() {\r\n        if (this.list) {\r\n          return (\r\n            this.total && this.$t('home.allBook').replace('$1', this.totalNumber)\r\n          )\r\n        } else {\r\n          return null\r\n        }\r\n      },\r\n      // 获取当前列表中电子书总数\r\n      totalNumber() {\r\n        let num = 0\r\n        Object.keys(this.list).forEach(key => {\r\n          num += this.list[key].length\r\n        })\r\n        return num\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        list: null,\r\n        total: null\r\n      }\r\n    },\r\n    methods: {\r\n      // 获取分类文本\r\n      getCategoryText(key) {\r\n        return `${categoryText(categoryList[key], this)}(${\r\n          this.list[key].length\r\n        })`\r\n      },\r\n      back() {\r\n        this.$router.go(-1)\r\n      },\r\n      // 标题阴影的隐藏状态\r\n      onScroll(offsetY) {\r\n        if (offsetY > realPx(42)) {\r\n          this.$refs.title.showShadow()\r\n        } else {\r\n          this.$refs.title.hideShadow()\r\n        }\r\n      },\r\n      // 通过API获取分类列表\r\n      getList() {\r\n        list().then(response => {\r\n          this.list = response.data.data\r\n          this.total = response.data.total\r\n          const category = this.$route.query.category\r\n          const keyword = this.$route.query.keyword\r\n          if (category) {\r\n            // 如果用户传入了分类数据，则从结果中搜索相应的分类数据并进行展示\r\n            const key = Object.keys(this.list).filter(\r\n              item => item === category\r\n            )[0]\r\n            const data = this.list[key]\r\n            this.list = {}\r\n            this.list[key] = data\r\n          } else if (keyword) {\r\n            console.log('search ing')\r\n            // 如果用户输入了关键字，则通过书名进行关键字匹配（搜索算法）\r\n            Object.keys(this.list).filter(key => {\r\n              this.list[key] = this.list[key].filter(\r\n                book => book.fileName.indexOf(keyword) >= 0\r\n              )\r\n              return this.list[key].length > 0\r\n            })\r\n          }\r\n        })\r\n      }\r\n    },\r\n    created() {\r\n      this.getList()\r\n      this.titleText = this.$route.query.categoryText\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\" rel=\"stylesheet/scss\" scoped>\r\n  @import '../../assets/styles/global';\r\n\r\n  .book-list-wrapper {\r\n    width: 100%;\r\n    height: 100%;\r\n    background: white;\r\n  }\r\n</style>\r\n"]}]}