{"remainingRequest":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\views\\store\\StoreList.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\views\\store\\StoreList.vue","mtime":1588676684269},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgRGV0YWlsVGl0bGUgZnJvbSAiLi4vLi4vY29tcG9uZW50cy9kZXRhaWwvRGV0YWlsVGl0bGUiOw0KaW1wb3J0IFNjcm9sbCBmcm9tICIuLi8uLi9jb21wb25lbnRzL2NvbW1vbi9TY3JvbGwiOw0KaW1wb3J0IEZlYXR1cmVkIGZyb20gIi4uLy4uL2NvbXBvbmVudHMvaG9tZS9GZWF0dXJlZCI7DQppbXBvcnQgeyByZWFsUHggfSBmcm9tICIuLi8uLi91dGlscy91dGlscyI7DQppbXBvcnQgeyBsaXN0IH0gZnJvbSAiLi4vLi4vYXBpL3N0b3JlIjsNCmltcG9ydCB7IGNhdGVnb3J5TGlzdCwgY2F0ZWdvcnlUZXh0IH0gZnJvbSAiLi4vLi4vdXRpbHMvc3RvcmUiOw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIGNvbXBvbmVudHM6IHsNCiAgICBEZXRhaWxUaXRsZSwNCiAgICBTY3JvbGwsDQogICAgRmVhdHVyZWQNCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgICAvLyDliqjmgIHnlJ/miJDmoIfpopjmlbDmja4NCiAgICB0aXRsZSgpIHsNCiAgICAgIGlmICh0aGlzLmxpc3QpIHsNCiAgICAgICAgcmV0dXJuICgNCiAgICAgICAgICB0aGlzLnRvdGFsICYmIHRoaXMuJHQoImhvbWUuYWxsQm9vayIpLnJlcGxhY2UoIiQxIiwgdGhpcy50b3RhbE51bWJlcikNCiAgICAgICAgKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBudWxsOw0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g6I635Y+W5b2T5YmN5YiX6KGo5Lit55S15a2Q5Lmm5oC75pWwDQogICAgdG90YWxOdW1iZXIoKSB7DQogICAgICBsZXQgbnVtID0gMDsNCiAgICAgIE9iamVjdC5rZXlzKHRoaXMubGlzdCkuZm9yRWFjaChrZXkgPT4gew0KICAgICAgICBudW0gKz0gdGhpcy5saXN0W2tleV0ubGVuZ3RoOw0KICAgICAgfSk7DQogICAgICByZXR1cm4gbnVtOw0KICAgIH0NCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgbGlzdDogbnVsbCwNCiAgICAgIHRvdGFsOiBudWxsDQogICAgfTsNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIC8vIOiOt+WPluWIhuexu+aWh+acrA0KICAgIGdldENhdGVnb3J5VGV4dChrZXkpIHsNCiAgICAgIHJldHVybiBgJHtjYXRlZ29yeVRleHQoY2F0ZWdvcnlMaXN0W2tleV0sIHRoaXMpfSgkew0KICAgICAgICB0aGlzLmxpc3Rba2V5XS5sZW5ndGgNCiAgICAgIH0pYDsNCiAgICB9LA0KICAgIGJhY2soKSB7DQogICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpOw0KICAgIH0sDQogICAgLy8g5qCH6aKY6Zi05b2x55qE6ZqQ6JeP54q25oCBDQogICAgb25TY3JvbGwob2Zmc2V0WSkgew0KICAgICAgaWYgKG9mZnNldFkgPiByZWFsUHgoNDIpKSB7DQogICAgICAgIHRoaXMuJHJlZnMudGl0bGUuc2hvd1NoYWRvdygpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy4kcmVmcy50aXRsZS5oaWRlU2hhZG93KCk7DQogICAgICB9DQogICAgfSwNCiAgICAvLyDpgJrov4dBUEnojrflj5bliIbnsbvliJfooagNCiAgICBnZXRMaXN0KCkgew0KICAgICAgbGlzdCgpLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICB0aGlzLmxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGE7DQogICAgICAgIHRoaXMudG90YWwgPSByZXNwb25zZS5kYXRhLnRvdGFsOw0KICAgICAgICBjb25zdCBjYXRlZ29yeSA9IHRoaXMuJHJvdXRlLnF1ZXJ5LmNhdGVnb3J5Ow0KICAgICAgICBjb25zdCBrZXl3b3JkID0gdGhpcy4kcm91dGUucXVlcnkua2V5d29yZDsNCiAgICAgICAgaWYgKGNhdGVnb3J5KSB7DQogICAgICAgICAgLy8g5aaC5p6c55So5oi35Lyg5YWl5LqG5YiG57G75pWw5o2u77yM5YiZ5LuO57uT5p6c5Lit5pCc57Si55u45bqU55qE5YiG57G75pWw5o2u5bm26L+b6KGM5bGV56S6DQogICAgICAgICAgY29uc3Qga2V5ID0gT2JqZWN0LmtleXModGhpcy5saXN0KS5maWx0ZXIoDQogICAgICAgICAgICBpdGVtID0+IGl0ZW0gPT09IGNhdGVnb3J5DQogICAgICAgICAgKVswXTsNCiAgICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5saXN0W2tleV07DQogICAgICAgICAgdGhpcy5saXN0ID0ge307DQogICAgICAgICAgdGhpcy5saXN0W2tleV0gPSBkYXRhOw0KICAgICAgICB9IGVsc2UgaWYgKGtleXdvcmQpIHsNCiAgICAgICAgICAvLyDlpoLmnpznlKjmiLfovpPlhaXkuoblhbPplK7lrZfvvIzliJnpgJrov4fkuablkI3ov5vooYzlhbPplK7lrZfljLnphY3vvIjmkJzntKLnrpfms5XvvIkNCiAgICAgICAgICBPYmplY3Qua2V5cyh0aGlzLmxpc3QpLmZpbHRlcihrZXkgPT4gew0KICAgICAgICAgICAgdGhpcy5saXN0W2tleV0gPSB0aGlzLmxpc3Rba2V5XS5maWx0ZXIoDQogICAgICAgICAgICAgIGJvb2sgPT4gYm9vay5maWxlTmFtZS5pbmRleE9mKGtleXdvcmQpID49IDANCiAgICAgICAgICAgICk7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5saXN0W2tleV0ubGVuZ3RoID4gMDsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfQ0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuZ2V0TGlzdCgpOw0KICAgIHRoaXMudGl0bGVUZXh0ID0gdGhpcy4kcm91dGUucXVlcnkuY2F0ZWdvcnlUZXh0Ow0KICB9DQp9Ow0K"},{"version":3,"sources":["StoreList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"StoreList.vue","sourceRoot":"src/views/store","sourcesContent":["<!-- 书城列表组件 -->\r\n<template>\r\n  <div class=\"book-list-wrapper\">\r\n    <detail-title\r\n      :title=\"title\"\r\n      :showShelf=\"true\"\r\n      @back=\"back\"\r\n      ref=\"title\"\r\n    ></detail-title>\r\n    <scroll\r\n      class=\"book-list-scroll-wrapper\"\r\n      :top=\"42\"\r\n      @onScroll=\"onScroll\"\r\n      ref=\"scroll\"\r\n    >\r\n      <featured\r\n        :data=\"value\"\r\n        :titleText=\"titleText ? titleText : getCategoryText(key)\"\r\n        :btnText=\"''\"\r\n        v-for=\"(value, key, index) in list\"\r\n        :key=\"index\"\r\n      ></featured>\r\n    </scroll>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport DetailTitle from \"../../components/detail/DetailTitle\";\r\nimport Scroll from \"../../components/common/Scroll\";\r\nimport Featured from \"../../components/home/Featured\";\r\nimport { realPx } from \"../../utils/utils\";\r\nimport { list } from \"../../api/store\";\r\nimport { categoryList, categoryText } from \"../../utils/store\";\r\n\r\nexport default {\r\n  components: {\r\n    DetailTitle,\r\n    Scroll,\r\n    Featured\r\n  },\r\n  computed: {\r\n    // 动态生成标题数据\r\n    title() {\r\n      if (this.list) {\r\n        return (\r\n          this.total && this.$t(\"home.allBook\").replace(\"$1\", this.totalNumber)\r\n        );\r\n      } else {\r\n        return null;\r\n      }\r\n    },\r\n    // 获取当前列表中电子书总数\r\n    totalNumber() {\r\n      let num = 0;\r\n      Object.keys(this.list).forEach(key => {\r\n        num += this.list[key].length;\r\n      });\r\n      return num;\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      list: null,\r\n      total: null\r\n    };\r\n  },\r\n  methods: {\r\n    // 获取分类文本\r\n    getCategoryText(key) {\r\n      return `${categoryText(categoryList[key], this)}(${\r\n        this.list[key].length\r\n      })`;\r\n    },\r\n    back() {\r\n      this.$router.go(-1);\r\n    },\r\n    // 标题阴影的隐藏状态\r\n    onScroll(offsetY) {\r\n      if (offsetY > realPx(42)) {\r\n        this.$refs.title.showShadow();\r\n      } else {\r\n        this.$refs.title.hideShadow();\r\n      }\r\n    },\r\n    // 通过API获取分类列表\r\n    getList() {\r\n      list().then(response => {\r\n        this.list = response.data.data;\r\n        this.total = response.data.total;\r\n        const category = this.$route.query.category;\r\n        const keyword = this.$route.query.keyword;\r\n        if (category) {\r\n          // 如果用户传入了分类数据，则从结果中搜索相应的分类数据并进行展示\r\n          const key = Object.keys(this.list).filter(\r\n            item => item === category\r\n          )[0];\r\n          const data = this.list[key];\r\n          this.list = {};\r\n          this.list[key] = data;\r\n        } else if (keyword) {\r\n          // 如果用户输入了关键字，则通过书名进行关键字匹配（搜索算法）\r\n          Object.keys(this.list).filter(key => {\r\n            this.list[key] = this.list[key].filter(\r\n              book => book.fileName.indexOf(keyword) >= 0\r\n            );\r\n            return this.list[key].length > 0;\r\n          });\r\n        }\r\n      });\r\n    }\r\n  },\r\n  created() {\r\n    this.getList();\r\n    this.titleText = this.$route.query.categoryText;\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" rel=\"stylesheet/scss\" scoped>\r\n@import \"../../assets/styles/global\";\r\n\r\n.book-list-wrapper {\r\n  width: 100%;\r\n  height: 100%;\r\n  background: white;\r\n}\r\n</style>\r\n"]}]}