{"remainingRequest":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\components\\Ebook\\EbookBookmark.vue?vue&type=style&index=0&id=2d4725fa&lang=scss&rel=stylesheet%2Fscss&scoped=true&","dependencies":[{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\components\\Ebook\\EbookBookmark.vue","mtime":1588150554609},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKQGltcG9ydCAnLi4vLi4vYXNzZXRzL3N0eWxlcy9nbG9iYWwnOwoKLmVib29rLWJvb2ttYXJrIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiBweDJyZW0oLTM1KTsKICBsZWZ0OiAwOwogIHotaW5kZXg6IDIwMDsKICB3aWR0aDogMTAwJTsKICBoZWlnaHQ6IHB4MnJlbSgzNSk7CiAgLmVib29rLWJvb2ttYXJrLXRleHQtd3JhcHBlciB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICByaWdodDogcHgycmVtKDQ1KTsKICAgIGJvdHRvbTogMDsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICAuZWJvb2stYm9va21hcmstZG93bi13cmFwcGVyIHsKICAgICAgZm9udC1zaXplOiBweDJyZW0oMTQpOwogICAgICBjb2xvcjogd2hpdGU7CiAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGxpbmVhcjsKICAgICAgQGluY2x1ZGUgY2VudGVyOwogICAgfQogICAgLmVib29rLWJvb2ttYXJrLXRleHQgewogICAgICBmb250LXNpemU6IHB4MnJlbSgxNCk7CiAgICAgIGNvbG9yOiB3aGl0ZTsKICAgIH0KICB9CiAgLmVib29rLWJvb2ttYXJrLWljb24td3JhcHBlciB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICByaWdodDogMDsKICAgIGJvdHRvbTogMDsKICAgIG1hcmdpbi1yaWdodDogcHgycmVtKDE1KTsKICB9Cn0K"},{"version":3,"sources":["EbookBookmark.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8KA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EbookBookmark.vue","sourceRoot":"src/components/Ebook","sourcesContent":["<template>\r\n  <div class=\"ebook-bookmark\" ref=\"bookmark\">\r\n    <div class=\"ebook-bookmark-text-wrapper\">\r\n      <div class=\"ebook-bookmark-down-wrapper\" ref=\"iconDown\">\r\n        <span class=\"icon-down\"></span>\r\n      </div>\r\n      <div class=\"ebook-bookmark-text\">{{text}}</div>\r\n    </div>\r\n    <div class=\"ebook-bookmark-icon-wrapper\" :style=\"isFixed ? fixedStyle : {}\">\r\n      <bookmark :color=\"color\" :width=\"15\" :height=\"35\"></bookmark>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import { realPx } from '../../utils/utils'\r\n  import Bookmark from './Bookmark'\r\n  import { ebookMixin } from '../../utils/mixin'\r\n  import { getBookmark, saveBookmark } from '../../utils/localStorage'\r\n\r\n  const BLUE = '#346cbc'\r\n  const WHITE = '#fff'\r\n  export default {\r\n    mixins: [ebookMixin],\r\n    components: {\r\n      Bookmark\r\n    },\r\n    computed: {\r\n      height() {\r\n        return realPx(35)\r\n      },\r\n      threshold() {\r\n        return realPx(55)\r\n      },\r\n      fixedStyle() {\r\n        return {\r\n          position: 'fixed',\r\n          top: 0,\r\n          right: `${(window.innerWidth - this.$refs.bookmark.clientWidth) / 2}px`\r\n        }\r\n      }\r\n    },\r\n    watch: {\r\n      offsetY(v) {\r\n        if (!this.bookAvailable || this.menuVisible || this.settingVisible >= 0) {\r\n          return\r\n        }\r\n        if (v >= this.height && v < this.threshold) {\r\n          this.beforeThreshold(v)\r\n        } else if (v >= this.threshold) {\r\n          this.afterThreshold(v)\r\n        } else if (v > 0 && v < this.height) {\r\n          this.beforeHeight()\r\n        } else if (v === 0) {\r\n          this.restore()\r\n        }\r\n      },\r\n      isBookmark(isBookmark) {\r\n        this.isFixed = isBookmark\r\n        if (isBookmark) {\r\n          this.color = BLUE\r\n        } else {\r\n          this.color = WHITE\r\n        }\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        text: '',\r\n        color: WHITE,\r\n        isFixed: false\r\n      }\r\n    },\r\n    methods: {\r\n      addBookmark() {\r\n        this.bookmark = getBookmark(this.filename)\r\n        if (!this.bookmark) {\r\n          this.bookmark = []\r\n        }\r\n        const currentLocation = this.currentBook.rendition.currentLocation()\r\n        const cfibase = currentLocation.start.cfi.replace(/!.*/, '')\r\n        const cfistart = currentLocation.start.cfi\r\n          .replace(/.*!/, '')\r\n          .replace(/\\)$/, '')\r\n        const cfiend = currentLocation.end.cfi\r\n          .replace(/.*!/, '')\r\n          .replace(/\\)$/, '')\r\n        const cfirange = `${cfibase}!,${cfistart},${cfiend})`\r\n        this.currentBook.getRange(cfirange).then(range => {\r\n          //去掉空格\r\n          const text = range.toString().replace(/\\s\\s/g, '')\r\n          //存储书签信息\r\n          if (!(currentLocation.start.cfi in this.bookmark)) {\r\n            //书签去重\r\n            this.bookmark.push({\r\n              cfi: currentLocation.start.cfi,\r\n              text: text\r\n            })\r\n            saveBookmark(this.filename, this.bookmark)\r\n          }\r\n        })\r\n      },\r\n      removeBookmark() {\r\n        const currentLocation = this.currentBook.rendition.currentLocation()\r\n        const cfi = currentLocation.start.cfi\r\n        this.bookmark = getBookmark(this.filename)\r\n        if (this.bookmark) {\r\n          saveBookmark(\r\n            this.filename,\r\n            this.bookmark.filter(item => item.cfi !== cfi)\r\n          )\r\n          this.setIsBookmark(false)\r\n        }\r\n      },\r\n      restore() {\r\n        // 状态4：归位\r\n        setTimeout(() => {\r\n          this.$refs.bookmark.style.top = `${-this.height}px`\r\n          this.$refs.iconDown.style.transform = 'rotate(0deg)'\r\n        }, 200)\r\n        if (this.isFixed) {\r\n          this.setIsBookmark(true)\r\n          this.addBookmark()\r\n        } else {\r\n          this.setIsBookmark(false)\r\n          this.removeBookmark()\r\n        }\r\n      },\r\n      beforeHeight() {\r\n        // 状态1：未超过书签的高度\r\n        if (this.isBookmark) {\r\n          this.text = this.$t('book.pulldownDeleteMark')\r\n          this.color = BLUE\r\n          this.isFixed = true\r\n        } else {\r\n          this.text = this.$t('book.pulldownAddMark')\r\n          this.color = WHITE\r\n          this.isFixed = false\r\n        }\r\n      },\r\n      beforeThreshold(v) {\r\n        // 状态2：未到达零界状态\r\n        this.$refs.bookmark.style.top = `${-v}px`\r\n        this.beforeHeight()\r\n        const iconDown = this.$refs.iconDown\r\n        if (iconDown.style.transform === 'rotate(180deg)') {\r\n          iconDown.style.transform = 'rotate(0deg)'\r\n        }\r\n      },\r\n      afterThreshold(v) {\r\n        // 状态3：超越零界状态\r\n        this.$refs.bookmark.style.top = `${-v}px`\r\n        if (this.isBookmark) {\r\n          this.text = this.$t('book.releaseDeleteMark')\r\n          this.color = WHITE\r\n          this.isFixed = false\r\n        } else {\r\n          this.text = this.$t('book.releaseAddMark')\r\n          this.color = BLUE\r\n          this.isFixed = true\r\n        }\r\n        const iconDown = this.$refs.iconDown\r\n        if (\r\n          iconDown.style.transform === '' ||\r\n          iconDown.style.transform === 'rotate(0deg)'\r\n        ) {\r\n          iconDown.style.transform = 'rotate(180deg)'\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\" rel=\"stylesheet/scss\" scoped>\r\n  @import '../../assets/styles/global';\r\n\r\n  .ebook-bookmark {\r\n    position: absolute;\r\n    top: px2rem(-35);\r\n    left: 0;\r\n    z-index: 200;\r\n    width: 100%;\r\n    height: px2rem(35);\r\n    .ebook-bookmark-text-wrapper {\r\n      position: absolute;\r\n      right: px2rem(45);\r\n      bottom: 0;\r\n      display: flex;\r\n      .ebook-bookmark-down-wrapper {\r\n        font-size: px2rem(14);\r\n        color: white;\r\n        transition: all 0.2s linear;\r\n        @include center;\r\n      }\r\n      .ebook-bookmark-text {\r\n        font-size: px2rem(14);\r\n        color: white;\r\n      }\r\n    }\r\n    .ebook-bookmark-icon-wrapper {\r\n      position: absolute;\r\n      right: 0;\r\n      bottom: 0;\r\n      margin-right: px2rem(15);\r\n    }\r\n  }\r\n</style>"]}]}