{"remainingRequest":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\components\\Ebook\\EbookReader.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\components\\Ebook\\EbookReader.vue","mtime":1587972159802},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KDQppbXBvcnQgRXB1YiBmcm9tICJlcHVianMiOw0KaW1wb3J0IHsgZWJvb2tNaXhpbiB9IGZyb20gIi4uLy4uL3V0aWxzL21peGluIjsNCmltcG9ydCB7DQogIGdldEZvbnRGYW1pbHksDQogIHNhdmVGb250RmFtaWx5LA0KICBnZXRGb250U2l6ZSwNCiAgc2F2ZUZvbnRTaXplDQp9IGZyb20gIi4uLy4uL3V0aWxzL2xvY2FsU3RvcmFnZSI7DQpnbG9iYWwuZVB1YiA9IEVwdWI7DQpleHBvcnQgZGVmYXVsdCB7DQogIG1peGluczogW2Vib29rTWl4aW5dLA0KICBtZXRob2RzOiB7DQogICAgcHJldlBhZ2UoKSB7DQogICAgICAvL+iwg+eUqFJlbmRpdGlvbueahHByZXbmlrnms5Xov5Tlm57kuIrkuIDpobUNCiAgICAgIGlmICh0aGlzLnJlbmRpdGlvbikgew0KICAgICAgICB0aGlzLnJlbmRpdGlvbi5wcmV2KCk7DQogICAgICAgIHRoaXMuaGlkZVRpdGxlQW5kTWVudSgpOw0KICAgICAgfQ0KICAgIH0sDQogICAgbmV4dFBhZ2UoKSB7DQogICAgICAvL+iwg+eUqFJlbmRpdGlvbueahG5leHTmlrnms5Xov5Tlm57kuIrkuIDpobUNCiAgICAgIGlmICh0aGlzLnJlbmRpdGlvbikgew0KICAgICAgICB0aGlzLnJlbmRpdGlvbi5uZXh0KCk7DQogICAgICAgIHRoaXMuaGlkZVRpdGxlQW5kTWVudSgpOw0KICAgICAgfQ0KICAgIH0sDQogICAgdG9nZ2xlVGl0bGVBbmRNZW51KCkgew0KICAgICAgaWYgKHRoaXMubWVudVZpc2libGUpIHsNCiAgICAgICAgdGhpcy5zZXRTZXR0aW5nVmlzaWJsZSgtMSk7DQogICAgICAgIHRoaXMuc2V0Rm9udEZhbWlseVZpc2libGUoZmFsc2UpOw0KICAgICAgfQ0KICAgICAgdGhpcy5zZXRNZW51VmlzaWJsZSghdGhpcy5tZW51VmlzaWJsZSk7DQogICAgfSwNCiAgICBoaWRlVGl0bGVBbmRNZW51KCkgew0KICAgICAgdGhpcy5zZXRNZW51VmlzaWJsZShmYWxzZSk7DQogICAgICB0aGlzLnNldFNldHRpbmdWaXNpYmxlKC0xKTsNCiAgICAgIHRoaXMuc2V0Rm9udEZhbWlseVZpc2libGUoZmFsc2UpOw0KICAgIH0sDQogICAgaW5pdEZvbnRTaXplKCkgew0KICAgICAgLy/or7vlj5Zsb2NhbFN0b3JhZ2XkuK3nmoRGb250U2l6ZQ0KICAgICAgbGV0IGZvbnRTaXplID0gZ2V0Rm9udFNpemUodGhpcy5maWxlbmFtZSk7DQogICAgICBpZiAoZm9udFNpemUpIHsNCiAgICAgICAgdGhpcy5yZW5kaXRpb24udGhlbWVzLmZvbnRTaXplKGZvbnRTaXplKTsNCiAgICAgICAgdGhpcy5zZXREZWZhdWx0Rm9udFNpemUoZm9udFNpemUpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc2F2ZUZvbnRTaXplKHRoaXMuZmlsZW5hbWUsIHRoaXMuZGVmYXVsdEZvbnRTaXplKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGluaXRGb250RmFtaWx5KCkgew0KICAgICAgLy/or7vlj5Zsb2NhbFN0b3JhZ2XkuK3nmoRGb250DQogICAgICBsZXQgZm9udCA9IGdldEZvbnRGYW1pbHkodGhpcy5maWxlbmFtZSk7DQogICAgICBpZiAoZm9udCkgew0KICAgICAgICB0aGlzLnJlbmRpdGlvbi50aGVtZXMuZm9udChmb250KTsNCiAgICAgICAgdGhpcy5zZXREZWZhdWx0Rm9udEZhbWlseShmb250KTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHNhdmVGb250RmFtaWx5KHRoaXMuZmlsZW5hbWUsIHRoaXMuZGVmYXVsdEZvbnRGYW1pbHkpOw0KICAgICAgfQ0KICAgIH0sDQogICAgaW5pdEVwdWIoKSB7DQogICAgICBjb25zdCB1cmwgPSAiaHR0cDovL2xvY2FsaG9zdDo4MDgxL2VwdWIvIiArIHRoaXMuZmlsZW5hbWUgKyAiLmVwdWIiOw0KICAgICAgLy/nlLXlrZDkuabnmoTop6PmnpDlkozmuLLmn5MNCiAgICAgIC8v55Sf5oiQRWJvb2vlr7nosaENCiAgICAgIHRoaXMuYm9vayA9IG5ldyBFcHViKHVybCk7DQogICAgICB0aGlzLnNldEN1cnJlbnRCb29rKHRoaXMuYm9vayk7DQogICAgICAvL+eUn+aIkFJlbmRpdGlvbuWvueixoQ0KICAgICAgdGhpcy5yZW5kaXRpb24gPSB0aGlzLmJvb2sucmVuZGVyVG8oInJlYWQiLCB7DQogICAgICAgIHdpZHRoOiB3aW5kb3cuaW5uZXJXaWR0aCwNCiAgICAgICAgaGVpZ2h0OiB3aW5kb3cuaW5uZXJIZWlnaHQsDQogICAgICAgIG1ldGhvZDogImRlZmF1bHQiDQogICAgICB9KTsNCiAgICAgIC8v6YCa6L+HUmVuZGl0aW9u5a+56LGh55qEZGlzcGxheeaWueazlea4suafk+eUteWtkOS5pg0KICAgICAgdGhpcy5yZW5kaXRpb24uZGlzcGxheSgpLnRoZW4oKCkgPT4gew0KICAgICAgICB0aGlzLmluaXRGb250U2l6ZSgpOw0KICAgICAgICB0aGlzLmluaXRGb250RmFtaWx5KCk7DQogICAgICB9KTsNCg0KICAgICAgLy/pgJrov4dvbuaWueazlee7keWumuS6i+S7tg0KICAgICAgdGhpcy5yZW5kaXRpb24ub24oInRvdWNoc3RhcnQiLCBldmVudCA9PiB7DQogICAgICAgIHRoaXMudG91Y2hTdGFydFggPSBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRYOw0KICAgICAgICB0aGlzLnRvdWNoU3RhcnRUaW1lID0gZXZlbnQudGltZVN0YW1wOw0KICAgICAgfSk7DQogICAgICB0aGlzLnJlbmRpdGlvbi5vbigidG91Y2hlbmQiLCBldmVudCA9PiB7DQogICAgICAgIGNvbnN0IG9mZnNldFggPSBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRYIC0gdGhpcy50b3VjaFN0YXJ0WDsNCiAgICAgICAgY29uc3QgdGltZSA9IGV2ZW50LnRpbWVTdGFtcCAtIHRoaXMudG91Y2hTdGFydFRpbWU7DQogICAgICAgIC8v5qC55o2u5omL5Yq/5LqL5Lu25a6e546w57+76aG15Yqf6IO9DQogICAgICAgIGlmICh0aW1lIDwgNTAwICYmIG9mZnNldFggPiA0MCkgew0KICAgICAgICAgIHRoaXMucHJldlBhZ2UoKTsNCiAgICAgICAgfSBlbHNlIGlmICh0aW1lIDwgNTAwICYmIG9mZnNldFggPCAtNDApIHsNCiAgICAgICAgICB0aGlzLm5leHRQYWdlKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy50b2dnbGVUaXRsZUFuZE1lbnUoKTsNCiAgICAgICAgfQ0KICAgICAgICAvL+e7hOe7h+m7mOiupOS6i+S7tuWSjOWGkuazoQ0KICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgIH0pOw0KICAgICAgdGhpcy5yZW5kaXRpb24uaG9va3MuY29udGVudC5yZWdpc3Rlcihjb250ZW50cyA9PiB7DQogICAgICAgIFByb21pc2UuYWxsKFsNCiAgICAgICAgICBjb250ZW50cy5hZGRTdHlsZXNoZWV0KA0KICAgICAgICAgICAgYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9SRVNfVVJMfS9mb250cy9jYWJpbi5jc3NgDQogICAgICAgICAgKSwNCiAgICAgICAgICBjb250ZW50cy5hZGRTdHlsZXNoZWV0KA0KICAgICAgICAgICAgYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9SRVNfVVJMfS9mb250cy9tb250c2VycmF0LmNzc2ANCiAgICAgICAgICApLA0KICAgICAgICAgIGNvbnRlbnRzLmFkZFN0eWxlc2hlZXQoDQogICAgICAgICAgICBgJHtwcm9jZXNzLmVudi5WVUVfQVBQX1JFU19VUkx9L2ZvbnRzL3RhbmdlcmluZS5jc3NgDQogICAgICAgICAgKSwNCiAgICAgICAgICBjb250ZW50cy5hZGRTdHlsZXNoZWV0KA0KICAgICAgICAgICAgYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9SRVNfVVJMfS9mb250cy9kYXlzT25lLmNzc2ANCiAgICAgICAgICApDQogICAgICAgIF0pLnRoZW4oKCkgPT4ge30pOw0KICAgICAgfSk7DQogICAgfQ0KICB9LA0KICBtb3VudGVkKCkgew0KICAgIGNvbnN0IGZpbGVuYW1lID0gdGhpcy4kcm91dGUucGFyYW1zLmZpbGVuYW1lLnNwbGl0KCJ8Iikuam9pbigiLyIpOw0KICAgIC8v6I635Y+W6Z2Z5oCB6LWE5rqQ55qE6Lev5b6EDQogICAgdGhpcy5zZXRGaWxlbmFtZShmaWxlbmFtZSkudGhlbigoKSA9PiB7DQogICAgICB0aGlzLmluaXRFcHViKCk7DQogICAgfSk7DQogIH0NCn07DQo="},{"version":3,"sources":["EbookReader.vue"],"names":[],"mappings":";;;;;;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EbookReader.vue","sourceRoot":"src/components/Ebook","sourcesContent":["<template>\r\n  <div class=\"ebook-reader\">\r\n    <div id=\"read\" @click=\"toggleTitleAndMenu\"></div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport Epub from \"epubjs\";\r\nimport { ebookMixin } from \"../../utils/mixin\";\r\nimport {\r\n  getFontFamily,\r\n  saveFontFamily,\r\n  getFontSize,\r\n  saveFontSize\r\n} from \"../../utils/localStorage\";\r\nglobal.ePub = Epub;\r\nexport default {\r\n  mixins: [ebookMixin],\r\n  methods: {\r\n    prevPage() {\r\n      //调用Rendition的prev方法返回上一页\r\n      if (this.rendition) {\r\n        this.rendition.prev();\r\n        this.hideTitleAndMenu();\r\n      }\r\n    },\r\n    nextPage() {\r\n      //调用Rendition的next方法返回上一页\r\n      if (this.rendition) {\r\n        this.rendition.next();\r\n        this.hideTitleAndMenu();\r\n      }\r\n    },\r\n    toggleTitleAndMenu() {\r\n      if (this.menuVisible) {\r\n        this.setSettingVisible(-1);\r\n        this.setFontFamilyVisible(false);\r\n      }\r\n      this.setMenuVisible(!this.menuVisible);\r\n    },\r\n    hideTitleAndMenu() {\r\n      this.setMenuVisible(false);\r\n      this.setSettingVisible(-1);\r\n      this.setFontFamilyVisible(false);\r\n    },\r\n    initFontSize() {\r\n      //读取localStorage中的FontSize\r\n      let fontSize = getFontSize(this.filename);\r\n      if (fontSize) {\r\n        this.rendition.themes.fontSize(fontSize);\r\n        this.setDefaultFontSize(fontSize);\r\n      } else {\r\n        saveFontSize(this.filename, this.defaultFontSize);\r\n      }\r\n    },\r\n    initFontFamily() {\r\n      //读取localStorage中的Font\r\n      let font = getFontFamily(this.filename);\r\n      if (font) {\r\n        this.rendition.themes.font(font);\r\n        this.setDefaultFontFamily(font);\r\n      } else {\r\n        saveFontFamily(this.filename, this.defaultFontFamily);\r\n      }\r\n    },\r\n    initEpub() {\r\n      const url = \"http://localhost:8081/epub/\" + this.filename + \".epub\";\r\n      //电子书的解析和渲染\r\n      //生成Ebook对象\r\n      this.book = new Epub(url);\r\n      this.setCurrentBook(this.book);\r\n      //生成Rendition对象\r\n      this.rendition = this.book.renderTo(\"read\", {\r\n        width: window.innerWidth,\r\n        height: window.innerHeight,\r\n        method: \"default\"\r\n      });\r\n      //通过Rendition对象的display方法渲染电子书\r\n      this.rendition.display().then(() => {\r\n        this.initFontSize();\r\n        this.initFontFamily();\r\n      });\r\n\r\n      //通过on方法绑定事件\r\n      this.rendition.on(\"touchstart\", event => {\r\n        this.touchStartX = event.changedTouches[0].clientX;\r\n        this.touchStartTime = event.timeStamp;\r\n      });\r\n      this.rendition.on(\"touchend\", event => {\r\n        const offsetX = event.changedTouches[0].clientX - this.touchStartX;\r\n        const time = event.timeStamp - this.touchStartTime;\r\n        //根据手势事件实现翻页功能\r\n        if (time < 500 && offsetX > 40) {\r\n          this.prevPage();\r\n        } else if (time < 500 && offsetX < -40) {\r\n          this.nextPage();\r\n        } else {\r\n          this.toggleTitleAndMenu();\r\n        }\r\n        //组织默认事件和冒泡\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n      });\r\n      this.rendition.hooks.content.register(contents => {\r\n        Promise.all([\r\n          contents.addStylesheet(\r\n            `${process.env.VUE_APP_RES_URL}/fonts/cabin.css`\r\n          ),\r\n          contents.addStylesheet(\r\n            `${process.env.VUE_APP_RES_URL}/fonts/montserrat.css`\r\n          ),\r\n          contents.addStylesheet(\r\n            `${process.env.VUE_APP_RES_URL}/fonts/tangerine.css`\r\n          ),\r\n          contents.addStylesheet(\r\n            `${process.env.VUE_APP_RES_URL}/fonts/daysOne.css`\r\n          )\r\n        ]).then(() => {});\r\n      });\r\n    }\r\n  },\r\n  mounted() {\r\n    const filename = this.$route.params.filename.split(\"|\").join(\"/\");\r\n    //获取静态资源的路径\r\n    this.setFilename(filename).then(() => {\r\n      this.initEpub();\r\n    });\r\n  }\r\n};\r\n</script>\r\n"]}]}