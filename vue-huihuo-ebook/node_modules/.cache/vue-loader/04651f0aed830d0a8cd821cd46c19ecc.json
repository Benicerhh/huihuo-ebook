{"remainingRequest":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\views\\store\\StoreDetail.vue?vue&type=style&index=0&id=c61a08cc&lang=scss&rel=stylesheet%2Fscss&scoped=true&","dependencies":[{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\views\\store\\StoreDetail.vue","mtime":1588676684269},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KQGltcG9ydCAiLi4vLi4vYXNzZXRzL3N0eWxlcy9nbG9iYWwiOw0KDQouYm9vay1kZXRhaWwgew0KICB3aWR0aDogMTAwJTsNCiAgYmFja2dyb3VuZDogd2hpdGU7DQogIC5jb250ZW50LXdyYXBwZXIgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIC5ib29rLWRldGFpbC1jb250ZW50LXdyYXBwZXIgew0KICAgICAgd2lkdGg6IDEwMCU7DQogICAgICBib3JkZXItYm90dG9tOiBweDJyZW0oMSkgc29saWQgI2VlZTsNCiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICAuYm9vay1kZXRhaWwtY29udGVudC10aXRsZSB7DQogICAgICAgIGZvbnQtc2l6ZTogcHgycmVtKDIwKTsNCiAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgIHBhZGRpbmc6IHB4MnJlbSgyMCkgcHgycmVtKDE1KSBweDJyZW0oMTApIHB4MnJlbSgxNSk7DQogICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICB9DQogICAgICAuYm9vay1kZXRhaWwtY29udGVudC1saXN0LXdyYXBwZXIgew0KICAgICAgICBwYWRkaW5nOiBweDJyZW0oMTApIHB4MnJlbSgxNSk7DQogICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICAgIC5sb2FkaW5nLXRleHQtd3JhcHBlciB7DQogICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgLmxvYWRpbmctdGV4dCB7DQogICAgICAgICAgICBmb250LXNpemU6IHB4MnJlbSgxNCk7DQogICAgICAgICAgICBjb2xvcjogIzY2NjsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLmJvb2stZGV0YWlsLWNvbnRlbnQtcm93IHsNCiAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICAgICAgbWFyZ2luLWJvdHRvbTogcHgycmVtKDEwKTsNCiAgICAgICAgICAuYm9vay1kZXRhaWwtY29udGVudC1sYWJlbCB7DQogICAgICAgICAgICBmbGV4OiAwIDAgcHgycmVtKDcwKTsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogcHgycmVtKDE0KTsNCiAgICAgICAgICAgIGNvbG9yOiAjNjY2Ow0KICAgICAgICAgIH0NCiAgICAgICAgICAuYm9vay1kZXRhaWwtY29udGVudC10ZXh0IHsNCiAgICAgICAgICAgIGZsZXg6IDE7DQogICAgICAgICAgICBmb250LXNpemU6IHB4MnJlbSgxNCk7DQogICAgICAgICAgICBjb2xvcjogIzMzMzsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgI3ByZXZpZXcgew0KICAgICAgICB9DQogICAgICAgIC5ib29rLWRldGFpbC1jb250ZW50LWl0ZW0td3JhcHBlciB7DQogICAgICAgICAgLmJvb2stZGV0YWlsLWNvbnRlbnQtaXRlbSB7DQogICAgICAgICAgICBwYWRkaW5nOiBweDJyZW0oMTUpIDA7DQogICAgICAgICAgICBmb250LXNpemU6IHB4MnJlbSgxNCk7DQogICAgICAgICAgICBsaW5lLWhlaWdodDogcHgycmVtKDE2KTsNCiAgICAgICAgICAgIGNvbG9yOiAjNjY2Ow0KICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogcHgycmVtKDEpIHNvbGlkICNlZWU7DQogICAgICAgICAgICAmOmxhc3QtY2hpbGQgew0KICAgICAgICAgICAgICBib3JkZXItYm90dG9tOiBub25lOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLmJvb2stZGV0YWlsLWNvbnRlbnQtbmF2aWdhdGlvbi10ZXh0IHsNCiAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICAgIEBpbmNsdWRlIGVsbGlwc2lzOw0KICAgICAgICAgICAgICAmLmlzLXN1YiB7DQogICAgICAgICAgICAgICAgY29sb3I6ICM2NjY7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgLmF1ZGlvLXdyYXBwZXIgew0KICAgICAgd2lkdGg6IDEwMCU7DQogICAgICBwYWRkaW5nOiBweDJyZW0oMTUpOw0KICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgICNhdWRpbyB7DQogICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KICAuYm90dG9tLXdyYXBwZXIgew0KICAgIHBvc2l0aW9uOiBmaXhlZDsNCiAgICBib3R0b206IDA7DQogICAgbGVmdDogMDsNCiAgICB6LWluZGV4OiAxMjA7DQogICAgZGlzcGxheTogZmxleDsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBoZWlnaHQ6IHB4MnJlbSg1Mik7DQogICAgYm94LXNoYWRvdzogMCBweDJyZW0oLTIpIHB4MnJlbSgyKSByZ2JhKDAsIDAsIDAsIDAuMSk7DQogICAgLmJvdHRvbS1idG4gew0KICAgICAgZmxleDogMTsNCiAgICAgIGNvbG9yOiAkY29sb3ItYmx1ZTsNCiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgZm9udC1zaXplOiBweDJyZW0oMTQpOw0KICAgICAgQGluY2x1ZGUgY2VudGVyOw0KICAgICAgJjphY3RpdmUgew0KICAgICAgICBjb2xvcjogJGNvbG9yLWJsdWUtdHJhbnNwYXJlbnQ7DQogICAgICB9DQogICAgICAuaWNvbi1jaGVjayB7DQogICAgICAgIG1hcmdpbi1yaWdodDogcHgycmVtKDUpOw0KICAgICAgfQ0KICAgIH0NCiAgICAmLmhpZGUtc2hhZG93IHsNCiAgICAgIGJveC1zaGFkb3c6IG5vbmU7DQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["StoreDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2YA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"StoreDetail.vue","sourceRoot":"src/views/store","sourcesContent":["<!-- 电子书详情组件 -->\r\n<template>\r\n  <div class=\"book-detail\">\r\n    <detail-title @back=\"back\" :showShelf=\"true\" ref=\"title\"></detail-title>\r\n    <scroll\r\n      class=\"content-wrapper\"\r\n      :top=\"42\"\r\n      :bottom=\"52\"\r\n      @onScroll=\"onScroll\"\r\n      ref=\"scroll\"\r\n    >\r\n      <book-info\r\n        :cover=\"cover\"\r\n        :title=\"title\"\r\n        :author=\"author\"\r\n        :desc=\"desc\"\r\n      ></book-info>\r\n      <div class=\"book-detail-content-wrapper\">\r\n        <div class=\"book-detail-content-title\">\r\n          {{ $t(\"detail.copyright\") }}\r\n        </div>\r\n        <div class=\"book-detail-content-list-wrapper\">\r\n          <div class=\"book-detail-content-row\">\r\n            <div class=\"book-detail-content-label\">\r\n              {{ $t(\"detail.publisher\") }}\r\n            </div>\r\n            <div class=\"book-detail-content-text\">{{ publisher }}</div>\r\n          </div>\r\n          <div class=\"book-detail-content-row\">\r\n            <div class=\"book-detail-content-label\">\r\n              {{ $t(\"detail.category\") }}\r\n            </div>\r\n            <div class=\"book-detail-content-text\">{{ categoryText }}</div>\r\n          </div>\r\n          <div class=\"book-detail-content-row\">\r\n            <div class=\"book-detail-content-label\">{{ $t(\"detail.lang\") }}</div>\r\n            <div class=\"book-detail-content-text\">{{ lang }}</div>\r\n          </div>\r\n          <div class=\"book-detail-content-row\">\r\n            <div class=\"book-detail-content-label\">{{ $t(\"detail.ISBN\") }}</div>\r\n            <div class=\"book-detail-content-text\">{{ isbn }}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"book-detail-content-wrapper\">\r\n        <div class=\"book-detail-content-title\">\r\n          {{ $t(\"detail.navigation\") }}\r\n        </div>\r\n        <div class=\"book-detail-content-list-wrapper\">\r\n          <div class=\"loading-text-wrapper\" v-if=\"!this.navigation\">\r\n            <span class=\"loading-text\">{{ $t(\"detail.loading\") }}</span>\r\n          </div>\r\n          <div class=\"book-detail-content-item-wrapper\">\r\n            <div\r\n              class=\"book-detail-content-item\"\r\n              v-for=\"(item, index) in flatNavigation\"\r\n              :key=\"index\"\r\n              @click=\"read(item)\"\r\n            >\r\n              <div\r\n                class=\"book-detail-content-navigation-text\"\r\n                :class=\"{ 'is-sub': item.deep > 1 }\"\r\n                :style=\"itemStyle(item)\"\r\n                v-if=\"item.label\"\r\n              >\r\n                {{ item.label }}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"book-detail-content-wrapper\">\r\n        <div class=\"book-detail-content-title\">{{ $t(\"detail.trial\") }}</div>\r\n        <div class=\"book-detail-content-list-wrapper\">\r\n          <div class=\"loading-text-wrapper\" v-if=\"!this.displayed\">\r\n            <span class=\"loading-text\">{{ $t(\"detail.loading\") }}</span>\r\n          </div>\r\n        </div>\r\n        <div id=\"preview\" v-show=\"this.displayed\" ref=\"preview\"></div>\r\n      </div>\r\n    </scroll>\r\n    <div class=\"bottom-wrapper\">\r\n      <div class=\"bottom-btn\" @click.stop.prevent=\"readBook()\">\r\n        {{ $t(\"detail.read\") }}\r\n      </div>\r\n      <div class=\"bottom-btn\" @click.stop.prevent=\"trialListening()\">\r\n        {{ $t(\"detail.listen\") }}\r\n      </div>\r\n      <div class=\"bottom-btn\" @click.stop.prevent=\"addOrRemoveShelf()\">\r\n        <span class=\"icon-check\" v-if=\"inBookShelf\"></span>\r\n        {{\r\n          inBookShelf\r\n            ? $t(\"detail.isAddedToShelf\")\r\n            : $t(\"detail.addOrRemoveShelf\")\r\n        }}\r\n      </div>\r\n    </div>\r\n    <toast :text=\"toastText\" ref=\"toast\"></toast>\r\n  </div>\r\n</template>\r\n\r\n<script type=\"text/ecmascript-6\">\r\nimport DetailTitle from '../../components/detail/DetailTitle'\r\nimport BookInfo from '../../components/detail/BookInfo'\r\nimport Scroll from '../../components/common/Scroll'\r\nimport Toast from '../../components/common/Toast'\r\nimport { detail } from '../../api/store'\r\nimport { px2rem, realPx } from '../../utils/utils'\r\n//import { getLocalForage } from '../../utils/'\r\nimport { removeFromBookShelf, addToShelf } from '../../utils/store'\r\nimport { storeShelfMixin } from '../../utils/mixin'\r\nimport { getBookShelf, saveBookShelf } from '../../utils/localStorage'\r\nimport Epub from 'epubjs'\r\n\r\nglobal.ePub = Epub\r\n\r\nexport default {\r\n  mixins: [storeShelfMixin],\r\n  components: {\r\n    DetailTitle,\r\n    Scroll,\r\n    BookInfo,\r\n    Toast\r\n  },\r\n  computed: {\r\n    // 获取电子书摘要\r\n    desc() {\r\n      if (this.description) {\r\n        return this.description.substring(0, 100)\r\n      } else {\r\n        return ''\r\n      }\r\n    },\r\n    // 将电子书目录转为一维数组\r\n    flatNavigation() {\r\n      if (this.navigation) {\r\n        return Array.prototype.concat.apply(\r\n          [],\r\n          Array.prototype.concat.apply(\r\n            [],\r\n            this.doFlatNavigation(this.navigation.toc)\r\n          )\r\n        )\r\n      } else {\r\n        return []\r\n      }\r\n    },\r\n    // 获取电子书语种\r\n    lang() {\r\n      return this.metadata ? this.metadata.language : '-'\r\n    },\r\n    // 获取电子书isbn\r\n    isbn() {\r\n      return this.metadata ? this.metadata.identifier : '-'\r\n    },\r\n    // 获取电子书出版社\r\n    publisher() {\r\n      return this.metadata ? this.metadata.publisher : '-'\r\n    },\r\n    // 获取电子书书名\r\n    title() {\r\n      return this.metadata ? this.metadata.title : ''\r\n    },\r\n    // 获取电子书作者\r\n    author() {\r\n      return this.metadata ? this.metadata.creator : ''\r\n    },\r\n    // 判断当前的电子书是否存在于书架\r\n    inBookShelf() {\r\n      if (this.bookItem && this.shelfList) {\r\n        // 定义一个自执行函数，将书架转为一维数组结构，并且只保留type为1的数据（type=1的为电子书）\r\n        const flatShelf = (function flatten(arr) {\r\n          return [].concat(\r\n            ...arr.map(v => (v.itemList ? [v, ...flatten(v.itemList)] : v))\r\n          )\r\n        })(this.shelfList).filter(item => item.type === 1)\r\n        // 查找当前电子书是否存在于书架\r\n        const book = flatShelf.filter(\r\n          item => item.fileName === this.bookItem.fileName\r\n        )\r\n        return book && book.length > 0\r\n      } else {\r\n        return false\r\n      }\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      bookItem: null,\r\n      book: null,\r\n      metadata: null,\r\n      trialRead: null,\r\n      cover: null,\r\n      navigation: null,\r\n      displayed: false,\r\n      audio: null,\r\n      randomLocation: null,\r\n      description: null,\r\n      toastText: '',\r\n      trialText: null,\r\n      categoryText: null,\r\n      opf: null\r\n    }\r\n  },\r\n  methods: {\r\n    addOrRemoveShelf() {\r\n      // 如果电子书存在于书架，则从书架中移除电子书\r\n      if (this.inBookShelf) {\r\n        this.setShelfList(removeFromBookShelf(this.bookItem)).then(() => {\r\n          // 将书架数据保存到LocalStorage\r\n          saveBookShelf(this.shelfList)\r\n        })\r\n      } else {\r\n        // 如果电子书不存在于书架，则添加电子书到书架\r\n        addToShelf(this.bookItem)\r\n        this.setShelfList(getBookShelf())\r\n      }\r\n    },\r\n    // 展示Toast弹窗\r\n    showToast(text) {\r\n      this.toastText = text\r\n      this.$refs.toast.show()\r\n    },\r\n    // 阅读电子书\r\n    readBook() {\r\n      // 跳转到阅读器页面\r\n      this.$router.push({\r\n        path: `/ebook/${this.bookItem.categoryText}|${this.fileName}`\r\n      })\r\n    },\r\n    // 听书\r\n    trialListening() {\r\n      // 如果电子书已经缓存，从IndexedDB中读取电子书\r\n      /*getLocalForage(this.bookItem.fileName, (err, blob) => {\r\n              if (!err && blob && blob instanceof Blob) {\r\n                this.$router.push({\r\n                  path: '/store/speaking',\r\n                  query: {\r\n                    fileName: this.bookItem.fileName\r\n                  }\r\n                })\r\n              } else {\r\n                // 如果没有缓存，直接跳转到听书页面\r\n                this.$router.push({\r\n                  path: '/store/speaking',\r\n                  query: {\r\n                    fileName: this.bookItem.fileName,\r\n                    opf: this.opf\r\n                  }\r\n                })\r\n              }\r\n            })\r\n\r\n          */\r\n    },\r\n    // 通过章节阅读电子书\r\n    read(item) {\r\n      this.$router.push({\r\n        path: `/ebook/${this.categoryText}|${this.fileName}`,\r\n        query: {\r\n          href: item.href\r\n        }\r\n      })\r\n    },\r\n    // 电子书目录缩进样式\r\n    itemStyle(item) {\r\n      return {\r\n        marginLeft: (item.deep - 1) * px2rem(20) + 'rem'\r\n      }\r\n    },\r\n    // 将目录从多维转为一维\r\n    doFlatNavigation(content, deep = 1) {\r\n      const arr = []\r\n      content.forEach(item => {\r\n        item.deep = deep\r\n        arr.push(item)\r\n        if (item.subitems && item.subitems.length > 0) {\r\n          arr.push(this.doFlatNavigation(item.subitems, deep + 1))\r\n        }\r\n      })\r\n      return arr\r\n    },\r\n    // 通过opf下载电子书（实现逐章下载，提供电子书访问性能）\r\n    downloadBook() {\r\n      // 拼接opf文件路径\r\n      const opf = `${process.env.VUE_APP_EPUB_URL}/${this.bookItem.categoryText}/${this.bookItem.fileName}/OEBPS/package.opf`\r\n      this.parseBook(opf)\r\n    },\r\n    // 解析电子书\r\n    parseBook(url) {\r\n      // 通过电子书或opf文件的url生成Book对象\r\n      this.book = new Epub(url)\r\n      // 获取电子书的metadata信息\r\n      this.book.loaded.metadata.then(metadata => {\r\n        this.metadata = metadata\r\n      })\r\n      // 获取电子书的目录信息\r\n      this.book.loaded.navigation.then(nav => {\r\n        this.navigation = nav\r\n        // 通过第二章的目录（第一章通常是封面，所以获取第二章）\r\n        if (this.navigation.toc && this.navigation.toc.length > 1) {\r\n          // 将第二章进行渲染（渲染的内容隐藏在屏幕外，用户是看不见的）\r\n          const candisplay = this.display(this.navigation.toc[1].href)\r\n          if (candisplay) {\r\n            candisplay.then(section => {\r\n              if (this.$refs.scroll) {\r\n                this.$refs.scroll.refresh()\r\n              }\r\n              this.displayed = true\r\n              // 渲染成功后通过section获取HTML文本，将HTML标签进行替换，提取纯文本信息\r\n              const reg = new RegExp('<.+?>', 'g')\r\n              const text = section.output.replace(reg, '').replace(/\\s\\s/g, '')\r\n              // 将纯文本信息保存到description变量中，用于进行摘要信息展示\r\n              this.description = text\r\n            })\r\n          }\r\n        }\r\n      })\r\n    },\r\n    // 电子书详情页初始化\r\n    init() {\r\n      // 获取电子书书名\r\n      this.fileName = this.$route.query.fileName\r\n      // 获取电子书分类\r\n      this.categoryText = this.$route.query.category\r\n      if (this.fileName) {\r\n        // 请求API，获取电子书详情数据\r\n        detail({\r\n          fileName: this.fileName\r\n        }).then(response => {\r\n          if (\r\n            response.status === 200 &&\r\n            response.data.error_code === 0 &&\r\n            response.data.data\r\n          ) {\r\n            const data = response.data.data\r\n            // 保存电子书详情数据\r\n            this.bookItem = data\r\n            // 获取封面数据\r\n            this.cover = this.bookItem.cover\r\n            // 获取rootFile数据\r\n            let rootFile = data.rootFile\r\n            if (rootFile.startsWith('/')) {\r\n              rootFile = rootFile.substring(1, rootFile.length)\r\n            }\r\n            // 根据rootFile拼接出opf文件路径\r\n            this.opf = `${process.env.VUE_APP_EPUB_OPF_URL}/${this.fileName}/${rootFile}`\r\n            // 解析电子书\r\n            this.parseBook(this.opf)\r\n          } else {\r\n            // 请求失败时打印错误提示\r\n            this.showToast(response.data.msg)\r\n          }\r\n        })\r\n      }\r\n    },\r\n    back() {\r\n      this.$router.go(-1)\r\n    },\r\n    // 根据传入的目录信息，渲染电子书\r\n    display(location) {\r\n      if (this.$refs.preview) {\r\n        if (!this.rendition) {\r\n          this.rendition = this.book.renderTo('preview', {\r\n            width: window.innerWidth > 640 ? 640 : window.innerWidth,\r\n            height: window.innerHeight,\r\n            method: 'default'\r\n          })\r\n        }\r\n        if (!location) {\r\n          return this.rendition.display()\r\n        } else {\r\n          return this.rendition.display(location)\r\n        }\r\n      }\r\n    },\r\n    // 处理用户滚动事件，确定标题阴影的显示状态\r\n    onScroll(offsetY) {\r\n      if (offsetY > realPx(42)) {\r\n        this.$refs.title.showShadow()\r\n      } else {\r\n        this.$refs.title.hideShadow()\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.init()\r\n    if (!this.shelfList || this.shelfList.length === 0) {\r\n      this.getShelfList()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" rel=\"stylesheet/scss\" scoped>\r\n@import \"../../assets/styles/global\";\r\n\r\n.book-detail {\r\n  width: 100%;\r\n  background: white;\r\n  .content-wrapper {\r\n    width: 100%;\r\n    .book-detail-content-wrapper {\r\n      width: 100%;\r\n      border-bottom: px2rem(1) solid #eee;\r\n      box-sizing: border-box;\r\n      .book-detail-content-title {\r\n        font-size: px2rem(20);\r\n        font-weight: bold;\r\n        padding: px2rem(20) px2rem(15) px2rem(10) px2rem(15);\r\n        box-sizing: border-box;\r\n      }\r\n      .book-detail-content-list-wrapper {\r\n        padding: px2rem(10) px2rem(15);\r\n        box-sizing: border-box;\r\n        .loading-text-wrapper {\r\n          width: 100%;\r\n          .loading-text {\r\n            font-size: px2rem(14);\r\n            color: #666;\r\n          }\r\n        }\r\n        .book-detail-content-row {\r\n          display: flex;\r\n          box-sizing: border-box;\r\n          margin-bottom: px2rem(10);\r\n          .book-detail-content-label {\r\n            flex: 0 0 px2rem(70);\r\n            font-size: px2rem(14);\r\n            color: #666;\r\n          }\r\n          .book-detail-content-text {\r\n            flex: 1;\r\n            font-size: px2rem(14);\r\n            color: #333;\r\n          }\r\n        }\r\n        #preview {\r\n        }\r\n        .book-detail-content-item-wrapper {\r\n          .book-detail-content-item {\r\n            padding: px2rem(15) 0;\r\n            font-size: px2rem(14);\r\n            line-height: px2rem(16);\r\n            color: #666;\r\n            border-bottom: px2rem(1) solid #eee;\r\n            &:last-child {\r\n              border-bottom: none;\r\n            }\r\n            .book-detail-content-navigation-text {\r\n              width: 100%;\r\n              @include ellipsis;\r\n              &.is-sub {\r\n                color: #666;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    .audio-wrapper {\r\n      width: 100%;\r\n      padding: px2rem(15);\r\n      box-sizing: border-box;\r\n      #audio {\r\n        width: 100%;\r\n      }\r\n    }\r\n  }\r\n  .bottom-wrapper {\r\n    position: fixed;\r\n    bottom: 0;\r\n    left: 0;\r\n    z-index: 120;\r\n    display: flex;\r\n    width: 100%;\r\n    height: px2rem(52);\r\n    box-shadow: 0 px2rem(-2) px2rem(2) rgba(0, 0, 0, 0.1);\r\n    .bottom-btn {\r\n      flex: 1;\r\n      color: $color-blue;\r\n      font-weight: bold;\r\n      font-size: px2rem(14);\r\n      @include center;\r\n      &:active {\r\n        color: $color-blue-transparent;\r\n      }\r\n      .icon-check {\r\n        margin-right: px2rem(5);\r\n      }\r\n    }\r\n    &.hide-shadow {\r\n      box-shadow: none;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}