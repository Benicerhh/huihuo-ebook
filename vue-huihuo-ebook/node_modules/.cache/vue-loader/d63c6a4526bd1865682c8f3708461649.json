{"remainingRequest":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\components\\shelf\\ShelfFooter.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\components\\shelf\\ShelfFooter.vue","mtime":1588729891730},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHN0b3JlU2hlbGZNaXhpbiB9IGZyb20gJy4uLy4uL3V0aWxzL21peGluJwppbXBvcnQgeyBzYXZlQm9va1NoZWxmLCByZW1vdmVMb2NhbFN0b3JhZ2UgfSBmcm9tICcuLi8uLi91dGlscy9sb2NhbFN0b3JhZ2UnCmltcG9ydCB7IHJlbW92ZUxvY2FsRm9yYWdlIH0gZnJvbSAnLi4vLi4vdXRpbHMvbG9jYWxGb3JhZ2UnCmltcG9ydCB7IGRvd25sb2FkIH0gZnJvbSAnLi4vLi4vYXBpL3N0b3JlJwpleHBvcnQgZGVmYXVsdCB7CiAgbWl4aW5zOiBbc3RvcmVTaGVsZk1peGluXSwKICBjb21wdXRlZDogewogICAgaXNTZWxlY3RlZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuc2hlbGZTZWxlY3RlZCAmJiB0aGlzLnNoZWxmU2VsZWN0ZWQubGVuZ3RoID4gMAogICAgfSwKICAgIHRhYnMoKSB7CiAgICAgIHJldHVybiBbCiAgICAgICAgewogICAgICAgICAgbGFiZWw6IHRoaXMuJHQoJ3NoZWxmLnByaXZhdGUnKSwKICAgICAgICAgIGxhYmVsMjogdGhpcy4kdCgnc2hlbGYubm9Qcml2YXRlJyksCiAgICAgICAgICBpbmRleDogMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbGFiZWw6IHRoaXMuJHQoJ3NoZWxmLmRvd25sb2FkJyksCiAgICAgICAgICBsYWJlbDI6IHRoaXMuJHQoJ3NoZWxmLmRlbGV0ZScpLAogICAgICAgICAgaW5kZXg6IDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGxhYmVsOiB0aGlzLiR0KCdzaGVsZi5tb3ZlJyksCiAgICAgICAgICBpbmRleDogMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbGFiZWw6IHRoaXMuJHQoJ3NoZWxmLnJlbW92ZScpLAogICAgICAgICAgaW5kZXg6IDQKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICBpc1ByaXZhdGUoKSB7CiAgICAgIGlmICghdGhpcy5pc1NlbGVjdGVkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2hlbGZTZWxlY3RlZC5ldmVyeShpdGVtID0+IGl0ZW0ucHJpdmF0ZSkKICAgICAgfQogICAgfSwKICAgIGlzRG93bmxvYWQoKSB7CiAgICAgIGlmICghdGhpcy5pc1NlbGVjdGVkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2hlbGZTZWxlY3RlZC5ldmVyeShpdGVtID0+IGl0ZW0uY2FjaGUpCiAgICAgIH0KICAgIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwb3B1cE1lbnU6IG51bGwKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGxhYmVsKGl0ZW0pIHsKICAgICAgc3dpdGNoIChpdGVtLmluZGV4KSB7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcmV0dXJuIHRoaXMuaXNQcml2YXRlID8gaXRlbS5sYWJlbDIgOiBpdGVtLmxhYmVsCiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHJldHVybiB0aGlzLmlzRG93bmxvYWQgPyBpdGVtLmxhYmVsMiA6IGl0ZW0ubGFiZWwKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIGl0ZW0ubGFiZWwKICAgICAgfQogICAgfSwKICAgIGhpZGVQb3B1cCgpIHsKICAgICAgdGhpcy5wb3B1cE1lbnUuaGlkZSgpCiAgICB9LAogICAgc2V0UHJpdmF0ZSgpIHsKICAgICAgbGV0IGlzUHJpdmF0ZQogICAgICBpZiAodGhpcy5pc1ByaXZhdGUpIHsKICAgICAgICBpc1ByaXZhdGUgPSBmYWxzZQogICAgICB9IGVsc2UgewogICAgICAgIGlzUHJpdmF0ZSA9IHRydWUKICAgICAgfQogICAgICB0aGlzLnNoZWxmU2VsZWN0ZWQuZm9yRWFjaChib29rID0+IHsKICAgICAgICBib29rLnByaXZhdGUgPSBpc1ByaXZhdGUKICAgICAgfSkKICAgICAgaWYgKGlzUHJpdmF0ZSkgewogICAgICAgIHRoaXMuc2ltcGxlVG9hc3QodGhpcy4kdCgnc2hlbGYuc2V0UHJpdmF0ZVN1Y2Nlc3MnKSkKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNpbXBsZVRvYXN0KHRoaXMuJHQoJ3NoZWxmLmNsb3NlUHJpdmF0ZVN1Y2Nlc3MnKSkKICAgICAgfQogICAgICB0aGlzLm9uQ29tcGxldGUoKQogICAgfSwKICAgIG9uQ29tcGxldGUoKSB7CiAgICAgIHRoaXMuaGlkZVBvcHVwKCkKICAgICAgdGhpcy5zZXRJc0VkaXRNb2RlKGZhbHNlKQogICAgICBzYXZlQm9va1NoZWxmKHRoaXMuc2hlbGZMaXN0KQogICAgfSwKICAgIGFzeW5jIGRvd25sb2FkU2VsZWN0ZWRCb29rKCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2hlbGZTZWxlY3RlZC5sZW5ndGg7IGkrKykgewogICAgICAgIGF3YWl0IHRoaXMuZG93bmxvYWRCb29rKHRoaXMuc2hlbGZTZWxlY3RlZFtpXSkudGhlbihib29rID0+IHsKICAgICAgICAgIGJvb2suY2FjaGUgPSB0cnVlCiAgICAgICAgfSkKICAgICAgfQogICAgfSwKICAgIGRvd25sb2FkQm9vayhib29rKSB7CiAgICAgIC8v55S15a2Q5Lmm5LiL6L29CiAgICAgIGxldCB0ZXh0ID0gJycKICAgICAgY29uc3QgdG9hc3QgPSB0aGlzLnRvYXN0KHsKICAgICAgICB0ZXh0CiAgICAgIH0pCiAgICAgIHRvYXN0LmNvbnRpbnVlU2hvdygpCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgZG93bmxvYWQoCiAgICAgICAgICBib29rLAogICAgICAgICAgYm9vayA9PiB7CiAgICAgICAgICAgIHRvYXN0LnJlbW92ZSgpCiAgICAgICAgICAgIC8v6ZSA5q+B77yM5LmL5ZCO6YeN5paw5a6e5L6L5YyWCiAgICAgICAgICAgIHJlc29sdmUoYm9vaykKICAgICAgICAgIH0sCiAgICAgICAgICByZWplY3QsCiAgICAgICAgICBwcm9ncmVzc0V2ZW50ID0+IHsKICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPQogICAgICAgICAgICAgIE1hdGguZmxvb3IoKHByb2dyZXNzRXZlbnQubG9hZGVkIC8gcHJvZ3Jlc3NFdmVudC50b3RhbCkgKiAxMDApICsKICAgICAgICAgICAgICAnJScKICAgICAgICAgICAgdGV4dCA9IHRoaXMuJHQoJ3NoZWxmLnByb2dyZXNzRG93bmxvYWQnKS5yZXBsYWNlKAogICAgICAgICAgICAgICckMScsCiAgICAgICAgICAgICAgYCR7Ym9vay5maWxlTmFtZX0uZXB1Yigke3Byb2dyZXNzfSlgCiAgICAgICAgICAgICkKICAgICAgICAgICAgdG9hc3QudXBkYXRlVGV4dCh0ZXh0KQogICAgICAgICAgfQogICAgICAgICkKICAgICAgfSkKICAgIH0sCiAgICByZW1vdmVTZWxlY3RlZEJvb2soKSB7CiAgICAgIFByb21pc2UuYWxsKHRoaXMuc2hlbGZTZWxlY3RlZC5tYXAoYm9vayA9PiB0aGlzLnJlbW92ZUJvb2soYm9vaykpKS50aGVuKAogICAgICAgIGJvb2tzID0+IHsKICAgICAgICAgIGJvb2tzLm1hcChib29rID0+IHsKICAgICAgICAgICAgYm9vay5jYWNoZSA9IGZhbHNlCiAgICAgICAgICB9KQogICAgICAgICAgc2F2ZUJvb2tTaGVsZih0aGlzLnNoZWxmTGlzdCkKICAgICAgICAgIHRoaXMuc2ltcGxlVG9hc3QodGhpcy4kdCgnc2hlbGYucmVtb3ZlRG93bmxvYWRTdWNjZXNzJykpCiAgICAgICAgfQogICAgICApCiAgICB9LAogICAgcmVtb3ZlQm9vayhib29rKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgcmVtb3ZlTG9jYWxTdG9yYWdlKGAke2Jvb2suY2F0ZWdvcnlUZXh0fS8ke2Jvb2suZmlsZU5hbWV9LWluZm9gKQogICAgICAgIHJlbW92ZUxvY2FsRm9yYWdlKGAke2Jvb2suZmlsZU5hbWV9YCkKICAgICAgICByZXNvbHZlKGJvb2spCiAgICAgIH0pCiAgICB9LAogICAgYXN5bmMgc2V0RG93bmxvYWQoKSB7CiAgICAgIHRoaXMub25Db21wbGV0ZSgpCiAgICAgIGlmICh0aGlzLmlzRG93bmxvYWQpIHsKICAgICAgICB0aGlzLnJlbW92ZVNlbGVjdGVkQm9vaygpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXdhaXQgdGhpcy5kb3dubG9hZFNlbGVjdGVkQm9vaygpCiAgICAgICAgc2F2ZUJvb2tTaGVsZih0aGlzLnNoZWxmTGlzdCkKICAgICAgICB0aGlzLnNpbXBsZVRvYXN0KHRoaXMuJHQoJ3NoZWxmLnNldERvd25sb2FkU3VjY2VzcycpKQogICAgICB9CiAgICB9LAogICAgc2hvd1ByaXZhdGUoKSB7CiAgICAgIHRoaXMucG9wdXBNZW51ID0gdGhpcy5wb3B1cCh7CiAgICAgICAgdGl0bGU6IHRoaXMuaXNQcml2YXRlCiAgICAgICAgICA/IHRoaXMuJHQoJ3NoZWxmLmNsb3NlUHJpdmF0ZVRpdGxlJykKICAgICAgICAgIDogdGhpcy4kdCgnc2hlbGYuc2V0UHJpdmF0ZVRpdGxlJyksCiAgICAgICAgYnRuOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHRleHQ6IHRoaXMuaXNQcml2YXRlCiAgICAgICAgICAgICAgPyB0aGlzLiR0KCdzaGVsZi5jbG9zZScpCiAgICAgICAgICAgICAgOiB0aGlzLiR0KCdzaGVsZi5vcGVuJyksCiAgICAgICAgICAgIGNsaWNrOiAoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5zZXRQcml2YXRlKCkKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgdGV4dDogdGhpcy4kdCgnc2hlbGYuY2FuY2VsJyksCiAgICAgICAgICAgIGNsaWNrOiAoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5oaWRlUG9wdXAoKQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgXQogICAgICB9KS5zaG93KCkKICAgIH0sCiAgICBzaG93RG93bmxvYWQoKSB7CiAgICAgIHRoaXMucG9wdXBNZW51ID0gdGhpcy5wb3B1cCh7CiAgICAgICAgdGl0bGU6IHRoaXMuaXNEb3dubG9hZAogICAgICAgICAgPyB0aGlzLiR0KCdzaGVsZi5yZW1vdmVEb3dubG9hZFRpdGxlJykKICAgICAgICAgIDogdGhpcy4kdCgnc2hlbGYuc2V0RG93bmxvYWRUaXRsZScpLAogICAgICAgIGJ0bjogWwogICAgICAgICAgewogICAgICAgICAgICB0ZXh0OiB0aGlzLmlzRG93bmxvYWQKICAgICAgICAgICAgICA/IHRoaXMuJHQoJ3NoZWxmLmRlbGV0ZScpCiAgICAgICAgICAgICAgOiB0aGlzLiR0KCdzaGVsZi5vcGVuJyksCiAgICAgICAgICAgIGNsaWNrOiAoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5zZXREb3dubG9hZCgpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIHRleHQ6IHRoaXMuJHQoJ3NoZWxmLmNhbmNlbCcpLAogICAgICAgICAgICBjbGljazogKCkgPT4gewogICAgICAgICAgICAgIHRoaXMuaGlkZVBvcHVwKCkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfSkuc2hvdygpCiAgICB9LAogICAgc2hvd1JlbW92ZSgpIHsKICAgICAgbGV0IHRpdGxlCiAgICAgIGlmICh0aGlzLnNoZWxmU2VsZWN0ZWQubGVuZ3RoID09PSAxKSB7CiAgICAgICAgdGl0bGUgPSB0aGlzLiR0KCdzaGVsZi5yZW1vdmVCb29rVGl0bGUnKS5yZXBsYWNlKAogICAgICAgICAgJyQxJywKICAgICAgICAgIGDjgIoke3RoaXMuc2hlbGZTZWxlY3RlZFswXS50aXRsZX3jgItgCiAgICAgICAgKQogICAgICB9IGVsc2UgewogICAgICAgIHRpdGxlID0gdGhpcy4kdCgnc2hlbGYucmVtb3ZlQm9va1RpdGxlJykucmVwbGFjZSgKICAgICAgICAgICckMScsCiAgICAgICAgICB0aGlzLiR0KCdzaGVsZi5zZWxlY3RlZEJvb2tzJykKICAgICAgICApCiAgICAgIH0KICAgICAgdGhpcy5wb3B1cE1lbnUgPSB0aGlzLnBvcHVwKHsKICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgYnRuOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHRleHQ6IHRoaXMuJHQoJ3NoZWxmLnJlbW92ZUJvb2snKSwKICAgICAgICAgICAgdHlwZTogJ2RhbmdlcicsCiAgICAgICAgICAgIGNsaWNrOiAoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5yZW1vdmVTZWxlY3RlZCgpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIHRleHQ6IHRoaXMuJHQoJ3NoZWxmLmNhbmNlbCcpLAogICAgICAgICAgICBjbGljazogKCkgPT4gewogICAgICAgICAgICAgIHRoaXMuaGlkZVBvcHVwKCkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfSkuc2hvdygpCiAgICB9LAogICAgcmVtb3ZlU2VsZWN0ZWQoKSB7CiAgICAgIHRoaXMuc2hlbGZTZWxlY3RlZC5mb3JFYWNoKHNlbGVjdGVkID0+IHsKICAgICAgICB0aGlzLnNldFNoZWxmTGlzdCh0aGlzLnNoZWxmTGlzdC5maWx0ZXIoYm9vayA9PiBib29rICE9PSBzZWxlY3RlZCkpCiAgICAgIH0pCiAgICAgIHRoaXMuc2V0U2hlbGZTZWxlY3RlZChbXSkKICAgICAgdGhpcy5vbkNvbXBsZXRlKCkKICAgIH0sCiAgICBvblRhYkNsaWNrKGl0ZW0pIHsKICAgICAgaWYgKCF0aGlzLmlzU2VsZWN0ZWQpIHsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICBzd2l0Y2ggKGl0ZW0uaW5kZXgpIHsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICB0aGlzLnNob3dQcml2YXRlKCkKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgdGhpcy5zaG93RG93bmxvYWQoKQogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICB0aGlzLmRpYWxvZygpLnNob3coKQogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlIDQ6CiAgICAgICAgICB0aGlzLnNob3dSZW1vdmUoKQogICAgICAgICAgYnJlYWsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgYnJlYWsKICAgICAgfQogICAgfQogIH0KfQo="},{"version":3,"sources":["ShelfFooter.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ShelfFooter.vue","sourceRoot":"src/components/shelf","sourcesContent":["<template>\r\n  <div class=\"shelf-footer\" v-show=\"isEditMode\">\r\n    <div\r\n      class=\"shelf-footer-tab-wrapper\"\r\n      v-for=\"item in tabs\"\r\n      :key=\"item.index\"\r\n      @click=\"onTabClick(item)\"\r\n    >\r\n      <div class=\"shelf-footer-tab\" :class=\"{ 'is-selected': isSelected }\">\r\n        <div\r\n          class=\"icon-private tab-icon\"\r\n          v-if=\"item.index === 1 && !isPrivate\"\r\n        ></div>\r\n        <div\r\n          class=\"icon-private-see tab-icon\"\r\n          v-if=\"item.index === 1 && isPrivate\"\r\n        ></div>\r\n        <div\r\n          class=\"icon-download tab-icon\"\r\n          v-if=\"item.index === 2 && !isDownload\"\r\n        ></div>\r\n        <div\r\n          class=\"icon-download-remove tab-icon\"\r\n          v-if=\"item.index === 2 && isDownload\"\r\n        ></div>\r\n        <div class=\"icon-move tab-icon\" v-show=\"item.index === 3\"></div>\r\n        <div class=\"icon-shelf tab-icon danger\" v-show=\"item.index === 4\"></div>\r\n        <div\r\n          class=\"tab-text\"\r\n          :class=\"{ danger: item.index === 4 }\"\r\n        >{{ label(item) }}</div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n  import { storeShelfMixin } from '../../utils/mixin'\r\n  import { saveBookShelf, removeLocalStorage } from '../../utils/localStorage'\r\n  import { removeLocalForage } from '../../utils/localForage'\r\n  import { download } from '../../api/store'\r\n  export default {\r\n    mixins: [storeShelfMixin],\r\n    computed: {\r\n      isSelected() {\r\n        return this.shelfSelected && this.shelfSelected.length > 0\r\n      },\r\n      tabs() {\r\n        return [\r\n          {\r\n            label: this.$t('shelf.private'),\r\n            label2: this.$t('shelf.noPrivate'),\r\n            index: 1\r\n          },\r\n          {\r\n            label: this.$t('shelf.download'),\r\n            label2: this.$t('shelf.delete'),\r\n            index: 2\r\n          },\r\n          {\r\n            label: this.$t('shelf.move'),\r\n            index: 3\r\n          },\r\n          {\r\n            label: this.$t('shelf.remove'),\r\n            index: 4\r\n          }\r\n        ]\r\n      },\r\n      isPrivate() {\r\n        if (!this.isSelected) {\r\n          return false\r\n        } else {\r\n          return this.shelfSelected.every(item => item.private)\r\n        }\r\n      },\r\n      isDownload() {\r\n        if (!this.isSelected) {\r\n          return false\r\n        } else {\r\n          return this.shelfSelected.every(item => item.cache)\r\n        }\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        popupMenu: null\r\n      }\r\n    },\r\n    methods: {\r\n      label(item) {\r\n        switch (item.index) {\r\n          case 1:\r\n            return this.isPrivate ? item.label2 : item.label\r\n            break\r\n          case 2:\r\n            return this.isDownload ? item.label2 : item.label\r\n          default:\r\n            return item.label\r\n        }\r\n      },\r\n      hidePopup() {\r\n        this.popupMenu.hide()\r\n      },\r\n      setPrivate() {\r\n        let isPrivate\r\n        if (this.isPrivate) {\r\n          isPrivate = false\r\n        } else {\r\n          isPrivate = true\r\n        }\r\n        this.shelfSelected.forEach(book => {\r\n          book.private = isPrivate\r\n        })\r\n        if (isPrivate) {\r\n          this.simpleToast(this.$t('shelf.setPrivateSuccess'))\r\n        } else {\r\n          this.simpleToast(this.$t('shelf.closePrivateSuccess'))\r\n        }\r\n        this.onComplete()\r\n      },\r\n      onComplete() {\r\n        this.hidePopup()\r\n        this.setIsEditMode(false)\r\n        saveBookShelf(this.shelfList)\r\n      },\r\n      async downloadSelectedBook() {\r\n        for (let i = 0; i < this.shelfSelected.length; i++) {\r\n          await this.downloadBook(this.shelfSelected[i]).then(book => {\r\n            book.cache = true\r\n          })\r\n        }\r\n      },\r\n      downloadBook(book) {\r\n        //电子书下载\r\n        let text = ''\r\n        const toast = this.toast({\r\n          text\r\n        })\r\n        toast.continueShow()\r\n        return new Promise((resolve, reject) => {\r\n          download(\r\n            book,\r\n            book => {\r\n              toast.remove()\r\n              //销毁，之后重新实例化\r\n              resolve(book)\r\n            },\r\n            reject,\r\n            progressEvent => {\r\n              const progress =\r\n                Math.floor((progressEvent.loaded / progressEvent.total) * 100) +\r\n                '%'\r\n              text = this.$t('shelf.progressDownload').replace(\r\n                '$1',\r\n                `${book.fileName}.epub(${progress})`\r\n              )\r\n              toast.updateText(text)\r\n            }\r\n          )\r\n        })\r\n      },\r\n      removeSelectedBook() {\r\n        Promise.all(this.shelfSelected.map(book => this.removeBook(book))).then(\r\n          books => {\r\n            books.map(book => {\r\n              book.cache = false\r\n            })\r\n            saveBookShelf(this.shelfList)\r\n            this.simpleToast(this.$t('shelf.removeDownloadSuccess'))\r\n          }\r\n        )\r\n      },\r\n      removeBook(book) {\r\n        return new Promise((resolve, reject) => {\r\n          removeLocalStorage(`${book.categoryText}/${book.fileName}-info`)\r\n          removeLocalForage(`${book.fileName}`)\r\n          resolve(book)\r\n        })\r\n      },\r\n      async setDownload() {\r\n        this.onComplete()\r\n        if (this.isDownload) {\r\n          this.removeSelectedBook()\r\n        } else {\r\n          await this.downloadSelectedBook()\r\n          saveBookShelf(this.shelfList)\r\n          this.simpleToast(this.$t('shelf.setDownloadSuccess'))\r\n        }\r\n      },\r\n      showPrivate() {\r\n        this.popupMenu = this.popup({\r\n          title: this.isPrivate\r\n            ? this.$t('shelf.closePrivateTitle')\r\n            : this.$t('shelf.setPrivateTitle'),\r\n          btn: [\r\n            {\r\n              text: this.isPrivate\r\n                ? this.$t('shelf.close')\r\n                : this.$t('shelf.open'),\r\n              click: () => {\r\n                this.setPrivate()\r\n              }\r\n            },\r\n            {\r\n              text: this.$t('shelf.cancel'),\r\n              click: () => {\r\n                this.hidePopup()\r\n              }\r\n            }\r\n          ]\r\n        }).show()\r\n      },\r\n      showDownload() {\r\n        this.popupMenu = this.popup({\r\n          title: this.isDownload\r\n            ? this.$t('shelf.removeDownloadTitle')\r\n            : this.$t('shelf.setDownloadTitle'),\r\n          btn: [\r\n            {\r\n              text: this.isDownload\r\n                ? this.$t('shelf.delete')\r\n                : this.$t('shelf.open'),\r\n              click: () => {\r\n                this.setDownload()\r\n              }\r\n            },\r\n            {\r\n              text: this.$t('shelf.cancel'),\r\n              click: () => {\r\n                this.hidePopup()\r\n              }\r\n            }\r\n          ]\r\n        }).show()\r\n      },\r\n      showRemove() {\r\n        let title\r\n        if (this.shelfSelected.length === 1) {\r\n          title = this.$t('shelf.removeBookTitle').replace(\r\n            '$1',\r\n            `《${this.shelfSelected[0].title}》`\r\n          )\r\n        } else {\r\n          title = this.$t('shelf.removeBookTitle').replace(\r\n            '$1',\r\n            this.$t('shelf.selectedBooks')\r\n          )\r\n        }\r\n        this.popupMenu = this.popup({\r\n          title: title,\r\n          btn: [\r\n            {\r\n              text: this.$t('shelf.removeBook'),\r\n              type: 'danger',\r\n              click: () => {\r\n                this.removeSelected()\r\n              }\r\n            },\r\n            {\r\n              text: this.$t('shelf.cancel'),\r\n              click: () => {\r\n                this.hidePopup()\r\n              }\r\n            }\r\n          ]\r\n        }).show()\r\n      },\r\n      removeSelected() {\r\n        this.shelfSelected.forEach(selected => {\r\n          this.setShelfList(this.shelfList.filter(book => book !== selected))\r\n        })\r\n        this.setShelfSelected([])\r\n        this.onComplete()\r\n      },\r\n      onTabClick(item) {\r\n        if (!this.isSelected) {\r\n          return\r\n        }\r\n        switch (item.index) {\r\n          case 1:\r\n            this.showPrivate()\r\n            break\r\n          case 2:\r\n            this.showDownload()\r\n            break\r\n          case 3:\r\n            this.dialog().show()\r\n            break\r\n          case 4:\r\n            this.showRemove()\r\n            break\r\n          default:\r\n            break\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n  @import '../../assets/styles/global.scss';\r\n  .shelf-footer {\r\n    position: fixed;\r\n    bottom: 0;\r\n    left: 0;\r\n    z-index: 120;\r\n    display: flex;\r\n    width: 100%;\r\n    height: px2rem(48);\r\n    background: white;\r\n    box-shadow: 0 px2rem(-2) px2rem(4) 0 rgba(0, 0, 0, 0.1);\r\n    .shelf-footer-tab-wrapper {\r\n      flex: 1;\r\n      width: 25%;\r\n      height: 100%;\r\n      .shelf-footer-tab {\r\n        width: 100%;\r\n        height: 100%;\r\n        opacity: 0.5;\r\n        @include columnCenter;\r\n        .tab-icon {\r\n          font-size: px2rem(20);\r\n          color: #666;\r\n        }\r\n        .tab-text {\r\n          margin-top: px2rem(5);\r\n          font-size: px2rem(12);\r\n          color: #666;\r\n        }\r\n        &.is-selected {\r\n          opacity: 1;\r\n        }\r\n        .danger {\r\n          color: $color-pink;\r\n        }\r\n      }\r\n    }\r\n  }\r\n</style>\r\n"]}]}