{"remainingRequest":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\components\\shelf\\ShelfFooter.vue?vue&type=style&index=0&id=962b9b60&lang=scss&scoped=true&","dependencies":[{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\components\\shelf\\ShelfFooter.vue","mtime":1588729891730},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpAaW1wb3J0ICcuLi8uLi9hc3NldHMvc3R5bGVzL2dsb2JhbC5zY3NzJzsKLnNoZWxmLWZvb3RlciB7CiAgcG9zaXRpb246IGZpeGVkOwogIGJvdHRvbTogMDsKICBsZWZ0OiAwOwogIHotaW5kZXg6IDEyMDsKICBkaXNwbGF5OiBmbGV4OwogIHdpZHRoOiAxMDAlOwogIGhlaWdodDogcHgycmVtKDQ4KTsKICBiYWNrZ3JvdW5kOiB3aGl0ZTsKICBib3gtc2hhZG93OiAwIHB4MnJlbSgtMikgcHgycmVtKDQpIDAgcmdiYSgwLCAwLCAwLCAwLjEpOwogIC5zaGVsZi1mb290ZXItdGFiLXdyYXBwZXIgewogICAgZmxleDogMTsKICAgIHdpZHRoOiAyNSU7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICAuc2hlbGYtZm9vdGVyLXRhYiB7CiAgICAgIHdpZHRoOiAxMDAlOwogICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgIG9wYWNpdHk6IDAuNTsKICAgICAgQGluY2x1ZGUgY29sdW1uQ2VudGVyOwogICAgICAudGFiLWljb24gewogICAgICAgIGZvbnQtc2l6ZTogcHgycmVtKDIwKTsKICAgICAgICBjb2xvcjogIzY2NjsKICAgICAgfQogICAgICAudGFiLXRleHQgewogICAgICAgIG1hcmdpbi10b3A6IHB4MnJlbSg1KTsKICAgICAgICBmb250LXNpemU6IHB4MnJlbSgxMik7CiAgICAgICAgY29sb3I6ICM2NjY7CiAgICAgIH0KICAgICAgJi5pcy1zZWxlY3RlZCB7CiAgICAgICAgb3BhY2l0eTogMTsKICAgICAgfQogICAgICAuZGFuZ2VyIHsKICAgICAgICBjb2xvcjogJGNvbG9yLXBpbms7CiAgICAgIH0KICAgIH0KICB9Cn0K"},{"version":3,"sources":["ShelfFooter.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2SA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ShelfFooter.vue","sourceRoot":"src/components/shelf","sourcesContent":["<template>\r\n  <div class=\"shelf-footer\" v-show=\"isEditMode\">\r\n    <div\r\n      class=\"shelf-footer-tab-wrapper\"\r\n      v-for=\"item in tabs\"\r\n      :key=\"item.index\"\r\n      @click=\"onTabClick(item)\"\r\n    >\r\n      <div class=\"shelf-footer-tab\" :class=\"{ 'is-selected': isSelected }\">\r\n        <div\r\n          class=\"icon-private tab-icon\"\r\n          v-if=\"item.index === 1 && !isPrivate\"\r\n        ></div>\r\n        <div\r\n          class=\"icon-private-see tab-icon\"\r\n          v-if=\"item.index === 1 && isPrivate\"\r\n        ></div>\r\n        <div\r\n          class=\"icon-download tab-icon\"\r\n          v-if=\"item.index === 2 && !isDownload\"\r\n        ></div>\r\n        <div\r\n          class=\"icon-download-remove tab-icon\"\r\n          v-if=\"item.index === 2 && isDownload\"\r\n        ></div>\r\n        <div class=\"icon-move tab-icon\" v-show=\"item.index === 3\"></div>\r\n        <div class=\"icon-shelf tab-icon danger\" v-show=\"item.index === 4\"></div>\r\n        <div\r\n          class=\"tab-text\"\r\n          :class=\"{ danger: item.index === 4 }\"\r\n        >{{ label(item) }}</div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n  import { storeShelfMixin } from '../../utils/mixin'\r\n  import { saveBookShelf, removeLocalStorage } from '../../utils/localStorage'\r\n  import { removeLocalForage } from '../../utils/localForage'\r\n  import { download } from '../../api/store'\r\n  export default {\r\n    mixins: [storeShelfMixin],\r\n    computed: {\r\n      isSelected() {\r\n        return this.shelfSelected && this.shelfSelected.length > 0\r\n      },\r\n      tabs() {\r\n        return [\r\n          {\r\n            label: this.$t('shelf.private'),\r\n            label2: this.$t('shelf.noPrivate'),\r\n            index: 1\r\n          },\r\n          {\r\n            label: this.$t('shelf.download'),\r\n            label2: this.$t('shelf.delete'),\r\n            index: 2\r\n          },\r\n          {\r\n            label: this.$t('shelf.move'),\r\n            index: 3\r\n          },\r\n          {\r\n            label: this.$t('shelf.remove'),\r\n            index: 4\r\n          }\r\n        ]\r\n      },\r\n      isPrivate() {\r\n        if (!this.isSelected) {\r\n          return false\r\n        } else {\r\n          return this.shelfSelected.every(item => item.private)\r\n        }\r\n      },\r\n      isDownload() {\r\n        if (!this.isSelected) {\r\n          return false\r\n        } else {\r\n          return this.shelfSelected.every(item => item.cache)\r\n        }\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        popupMenu: null\r\n      }\r\n    },\r\n    methods: {\r\n      label(item) {\r\n        switch (item.index) {\r\n          case 1:\r\n            return this.isPrivate ? item.label2 : item.label\r\n            break\r\n          case 2:\r\n            return this.isDownload ? item.label2 : item.label\r\n          default:\r\n            return item.label\r\n        }\r\n      },\r\n      hidePopup() {\r\n        this.popupMenu.hide()\r\n      },\r\n      setPrivate() {\r\n        let isPrivate\r\n        if (this.isPrivate) {\r\n          isPrivate = false\r\n        } else {\r\n          isPrivate = true\r\n        }\r\n        this.shelfSelected.forEach(book => {\r\n          book.private = isPrivate\r\n        })\r\n        if (isPrivate) {\r\n          this.simpleToast(this.$t('shelf.setPrivateSuccess'))\r\n        } else {\r\n          this.simpleToast(this.$t('shelf.closePrivateSuccess'))\r\n        }\r\n        this.onComplete()\r\n      },\r\n      onComplete() {\r\n        this.hidePopup()\r\n        this.setIsEditMode(false)\r\n        saveBookShelf(this.shelfList)\r\n      },\r\n      async downloadSelectedBook() {\r\n        for (let i = 0; i < this.shelfSelected.length; i++) {\r\n          await this.downloadBook(this.shelfSelected[i]).then(book => {\r\n            book.cache = true\r\n          })\r\n        }\r\n      },\r\n      downloadBook(book) {\r\n        //电子书下载\r\n        let text = ''\r\n        const toast = this.toast({\r\n          text\r\n        })\r\n        toast.continueShow()\r\n        return new Promise((resolve, reject) => {\r\n          download(\r\n            book,\r\n            book => {\r\n              toast.remove()\r\n              //销毁，之后重新实例化\r\n              resolve(book)\r\n            },\r\n            reject,\r\n            progressEvent => {\r\n              const progress =\r\n                Math.floor((progressEvent.loaded / progressEvent.total) * 100) +\r\n                '%'\r\n              text = this.$t('shelf.progressDownload').replace(\r\n                '$1',\r\n                `${book.fileName}.epub(${progress})`\r\n              )\r\n              toast.updateText(text)\r\n            }\r\n          )\r\n        })\r\n      },\r\n      removeSelectedBook() {\r\n        Promise.all(this.shelfSelected.map(book => this.removeBook(book))).then(\r\n          books => {\r\n            books.map(book => {\r\n              book.cache = false\r\n            })\r\n            saveBookShelf(this.shelfList)\r\n            this.simpleToast(this.$t('shelf.removeDownloadSuccess'))\r\n          }\r\n        )\r\n      },\r\n      removeBook(book) {\r\n        return new Promise((resolve, reject) => {\r\n          removeLocalStorage(`${book.categoryText}/${book.fileName}-info`)\r\n          removeLocalForage(`${book.fileName}`)\r\n          resolve(book)\r\n        })\r\n      },\r\n      async setDownload() {\r\n        this.onComplete()\r\n        if (this.isDownload) {\r\n          this.removeSelectedBook()\r\n        } else {\r\n          await this.downloadSelectedBook()\r\n          saveBookShelf(this.shelfList)\r\n          this.simpleToast(this.$t('shelf.setDownloadSuccess'))\r\n        }\r\n      },\r\n      showPrivate() {\r\n        this.popupMenu = this.popup({\r\n          title: this.isPrivate\r\n            ? this.$t('shelf.closePrivateTitle')\r\n            : this.$t('shelf.setPrivateTitle'),\r\n          btn: [\r\n            {\r\n              text: this.isPrivate\r\n                ? this.$t('shelf.close')\r\n                : this.$t('shelf.open'),\r\n              click: () => {\r\n                this.setPrivate()\r\n              }\r\n            },\r\n            {\r\n              text: this.$t('shelf.cancel'),\r\n              click: () => {\r\n                this.hidePopup()\r\n              }\r\n            }\r\n          ]\r\n        }).show()\r\n      },\r\n      showDownload() {\r\n        this.popupMenu = this.popup({\r\n          title: this.isDownload\r\n            ? this.$t('shelf.removeDownloadTitle')\r\n            : this.$t('shelf.setDownloadTitle'),\r\n          btn: [\r\n            {\r\n              text: this.isDownload\r\n                ? this.$t('shelf.delete')\r\n                : this.$t('shelf.open'),\r\n              click: () => {\r\n                this.setDownload()\r\n              }\r\n            },\r\n            {\r\n              text: this.$t('shelf.cancel'),\r\n              click: () => {\r\n                this.hidePopup()\r\n              }\r\n            }\r\n          ]\r\n        }).show()\r\n      },\r\n      showRemove() {\r\n        let title\r\n        if (this.shelfSelected.length === 1) {\r\n          title = this.$t('shelf.removeBookTitle').replace(\r\n            '$1',\r\n            `《${this.shelfSelected[0].title}》`\r\n          )\r\n        } else {\r\n          title = this.$t('shelf.removeBookTitle').replace(\r\n            '$1',\r\n            this.$t('shelf.selectedBooks')\r\n          )\r\n        }\r\n        this.popupMenu = this.popup({\r\n          title: title,\r\n          btn: [\r\n            {\r\n              text: this.$t('shelf.removeBook'),\r\n              type: 'danger',\r\n              click: () => {\r\n                this.removeSelected()\r\n              }\r\n            },\r\n            {\r\n              text: this.$t('shelf.cancel'),\r\n              click: () => {\r\n                this.hidePopup()\r\n              }\r\n            }\r\n          ]\r\n        }).show()\r\n      },\r\n      removeSelected() {\r\n        this.shelfSelected.forEach(selected => {\r\n          this.setShelfList(this.shelfList.filter(book => book !== selected))\r\n        })\r\n        this.setShelfSelected([])\r\n        this.onComplete()\r\n      },\r\n      onTabClick(item) {\r\n        if (!this.isSelected) {\r\n          return\r\n        }\r\n        switch (item.index) {\r\n          case 1:\r\n            this.showPrivate()\r\n            break\r\n          case 2:\r\n            this.showDownload()\r\n            break\r\n          case 3:\r\n            this.dialog().show()\r\n            break\r\n          case 4:\r\n            this.showRemove()\r\n            break\r\n          default:\r\n            break\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n  @import '../../assets/styles/global.scss';\r\n  .shelf-footer {\r\n    position: fixed;\r\n    bottom: 0;\r\n    left: 0;\r\n    z-index: 120;\r\n    display: flex;\r\n    width: 100%;\r\n    height: px2rem(48);\r\n    background: white;\r\n    box-shadow: 0 px2rem(-2) px2rem(4) 0 rgba(0, 0, 0, 0.1);\r\n    .shelf-footer-tab-wrapper {\r\n      flex: 1;\r\n      width: 25%;\r\n      height: 100%;\r\n      .shelf-footer-tab {\r\n        width: 100%;\r\n        height: 100%;\r\n        opacity: 0.5;\r\n        @include columnCenter;\r\n        .tab-icon {\r\n          font-size: px2rem(20);\r\n          color: #666;\r\n        }\r\n        .tab-text {\r\n          margin-top: px2rem(5);\r\n          font-size: px2rem(12);\r\n          color: #666;\r\n        }\r\n        &.is-selected {\r\n          opacity: 1;\r\n        }\r\n        .danger {\r\n          color: $color-pink;\r\n        }\r\n      }\r\n    }\r\n  }\r\n</style>\r\n"]}]}