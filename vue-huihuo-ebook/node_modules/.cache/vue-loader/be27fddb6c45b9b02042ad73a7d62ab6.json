{"remainingRequest":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\components\\Ebook\\EbookReader.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\components\\Ebook\\EbookReader.vue","mtime":1588930847435},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgRXB1YiBmcm9tICJlcHVianMiOw0KaW1wb3J0IHsgZWJvb2tNaXhpbiB9IGZyb20gIi4uLy4uL3V0aWxzL21peGluIjsNCmltcG9ydCB7DQogIGdldEZvbnRGYW1pbHksDQogIHNhdmVGb250RmFtaWx5LA0KICBnZXRGb250U2l6ZSwNCiAgc2F2ZUZvbnRTaXplLA0KICBnZXRUaGVtZSwNCiAgc2F2ZVRoZW1lLA0KICBnZXRMb2NhdGlvbg0KfSBmcm9tICIuLi8uLi91dGlscy9sb2NhbFN0b3JhZ2UiOw0KaW1wb3J0IHsgZ2V0TG9jYWxGb3JhZ2UgfSBmcm9tICIuLi8uLi91dGlscy9sb2NhbEZvcmFnZSI7DQpnbG9iYWwuZVB1YiA9IEVwdWI7DQpleHBvcnQgZGVmYXVsdCB7DQogIG1peGluczogW2Vib29rTWl4aW5dLA0KICBtZXRob2RzOiB7DQogICAgbW92ZShlKSB7DQogICAgICBsZXQgb2Zmc2V0WSA9IDA7DQogICAgICBpZiAodGhpcy5maXJzdE9mZnNldFkpIHsNCiAgICAgICAgb2Zmc2V0WSA9IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WSAtIHRoaXMuZmlyc3RPZmZzZXRZOw0KICAgICAgICB0aGlzLnNldE9mZnNldFkob2Zmc2V0WSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLmZpcnN0T2Zmc2V0WSA9IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WTsNCiAgICAgIH0NCiAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgfSwNCiAgICBtb3ZlRW5kKGUpIHsNCiAgICAgIHRoaXMuc2V0T2Zmc2V0WSgwKTsNCiAgICAgIHRoaXMuZmlyc3RPZmZzZXRZID0gMDsNCiAgICB9LA0KICAgIG9uTW91c2VFbnRlcihlKSB7DQogICAgICB0aGlzLm1vdXNlTW92ZSA9IDE7DQogICAgICB0aGlzLm1vdXNlU3RhcnRUaW1lID0gZS50aW1lU3RhbXA7DQogICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgIH0sDQogICAgb25Nb3VzZU1vdmUoZSkgew0KICAgICAgaWYgKHRoaXMubW91c2VNb3ZlID09PSAxKSB7DQogICAgICAgIHRoaXMubW91c2VNb3ZlID0gMjsNCiAgICAgIH0gZWxzZSBpZiAodGhpcy5tb3VzZU1vdmUgPT09IDIpIHsNCiAgICAgICAgbGV0IG9mZnNldFkgPSAwOw0KICAgICAgICBpZiAodGhpcy5maXJzdE9mZnNldFkpIHsNCiAgICAgICAgICBvZmZzZXRZID0gZS5jbGllbnRZIC0gdGhpcy5maXJzdE9mZnNldFk7DQogICAgICAgICAgdGhpcy5zZXRPZmZzZXRZKG9mZnNldFkpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMuZmlyc3RPZmZzZXRZID0gZS5jbGllbnRZOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgIH0sDQogICAgb25Nb3VzZUVuZChlKSB7DQogICAgICBpZiAodGhpcy5tb3VzZU1vdmUgPT09IDIpIHsNCiAgICAgICAgdGhpcy5zZXRPZmZzZXRZKDApOw0KICAgICAgICB0aGlzLmZpcnN0T2Zmc2V0WSA9IDA7DQogICAgICAgIHRoaXMubW91c2VNb3ZlID0gMzsNCiAgICAgIH0NCiAgICAgIHRoaXMubW91c2VFbmRUaW1lID0gZS50aW1lU3RhbXA7DQogICAgICBjb25zdCB0aW1lID0gdGhpcy5tb3VzZUVuZFRpbWUgLSB0aGlzLm1vdXNlU3RhcnRUaW1lOw0KICAgICAgaWYgKHRpbWUgPCAyMDApIHsNCiAgICAgICAgdGhpcy5tb3VzZU1vdmUgPSAxOw0KICAgICAgfQ0KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICB9LA0KICAgIG9uTWFza0NsaWNrKGUpIHsNCiAgICAgIGNvbnN0IG9mZnNldFggPSBlLm9mZnNldFg7DQogICAgICBjb25zdCB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoOw0KICAgICAgaWYgKG9mZnNldFggPiAwICYmIG9mZnNldFggPCB3aWR0aCAqIDAuMykgew0KICAgICAgICB0aGlzLnByZXZQYWdlKCk7DQogICAgICB9IGVsc2UgaWYgKG9mZnNldFggPiAwICYmIG9mZnNldFggPiB3aWR0aCAqIDAuNykgew0KICAgICAgICB0aGlzLm5leHRQYWdlKCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLnRvZ2dsZVRpdGxlQW5kTWVudSgpOw0KICAgICAgfQ0KICAgIH0sDQogICAgcHJldlBhZ2UoKSB7DQogICAgICAvL+iwg+eUqFJlbmRpdGlvbueahHByZXbmlrnms5Xov5Tlm57kuIrkuIDpobUNCiAgICAgIGlmICh0aGlzLnJlbmRpdGlvbikgew0KICAgICAgICB0aGlzLnJlbmRpdGlvbi5wcmV2KCkudGhlbigoKSA9PiB7DQogICAgICAgICAgdGhpcy5yZWZyZXNoTG9jYXRpb24oKTsNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgICB0aGlzLmhpZGVUaXRsZUFuZE1lbnUoKTsNCiAgICB9LA0KICAgIG5leHRQYWdlKCkgew0KICAgICAgLy/osIPnlKhSZW5kaXRpb27nmoRuZXh05pa55rOV6L+U5Zue5LiK5LiA6aG1DQogICAgICBpZiAodGhpcy5yZW5kaXRpb24pIHsNCiAgICAgICAgdGhpcy5yZW5kaXRpb24ubmV4dCgpLnRoZW4oKCkgPT4gew0KICAgICAgICAgIHRoaXMucmVmcmVzaExvY2F0aW9uKCk7DQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgICAgdGhpcy5oaWRlVGl0bGVBbmRNZW51KCk7DQogICAgfSwNCiAgICB0b2dnbGVUaXRsZUFuZE1lbnUoKSB7DQogICAgICBpZiAodGhpcy5tZW51VmlzaWJsZSkgew0KICAgICAgICB0aGlzLnNldFNldHRpbmdWaXNpYmxlKC0xKTsNCiAgICAgICAgdGhpcy5zZXRGb250RmFtaWx5VmlzaWJsZShmYWxzZSk7DQogICAgICB9DQogICAgICB0aGlzLnNldE1lbnVWaXNpYmxlKCF0aGlzLm1lbnVWaXNpYmxlKTsNCiAgICB9LA0KDQogICAgaW5pdEZvbnRTaXplKCkgew0KICAgICAgLy/or7vlj5Zsb2NhbFN0b3JhZ2XkuK3nmoRGb250U2l6ZQ0KICAgICAgbGV0IGZvbnRTaXplID0gZ2V0Rm9udFNpemUodGhpcy5maWxlTmFtZSk7DQogICAgICBpZiAoZm9udFNpemUpIHsNCiAgICAgICAgdGhpcy5yZW5kaXRpb24udGhlbWVzLmZvbnRTaXplKGZvbnRTaXplKTsNCiAgICAgICAgdGhpcy5zZXREZWZhdWx0Rm9udFNpemUoZm9udFNpemUpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc2F2ZUZvbnRTaXplKHRoaXMuZmlsZU5hbWUsIHRoaXMuZGVmYXVsdEZvbnRTaXplKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGluaXRGb250RmFtaWx5KCkgew0KICAgICAgLy/or7vlj5Zsb2NhbFN0b3JhZ2XkuK3nmoRGb250DQogICAgICBsZXQgZm9udCA9IGdldEZvbnRGYW1pbHkodGhpcy5maWxlTmFtZSk7DQogICAgICBpZiAoZm9udCkgew0KICAgICAgICB0aGlzLnJlbmRpdGlvbi50aGVtZXMuZm9udChmb250KTsNCiAgICAgICAgdGhpcy5zZXREZWZhdWx0Rm9udEZhbWlseShmb250KTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHNhdmVGb250RmFtaWx5KHRoaXMuZmlsZU5hbWUsIHRoaXMuZGVmYXVsdEZvbnRGYW1pbHkpOw0KICAgICAgfQ0KICAgIH0sDQogICAgaW5pdFRoZW1lKCkgew0KICAgICAgLy/liJ3lp4vljJbkuLvpopgNCiAgICAgIGxldCBkZWZhdWx0VGhlbWUgPSBnZXRUaGVtZSh0aGlzLmZpbGVOYW1lKTsNCiAgICAgIGlmICghZGVmYXVsdFRoZW1lKSB7DQogICAgICAgIGRlZmF1bHRUaGVtZSA9IHRoaXMudGhlbWVMaXN0WzBdLm5hbWU7DQogICAgICAgIHNhdmVUaGVtZSh0aGlzLmZpbGVOYW1lLCBkZWZhdWx0VGhlbWUpOw0KICAgICAgfQ0KICAgICAgdGhpcy5zZXREZWZhdWx0VGhlbWUoZGVmYXVsdFRoZW1lKTsNCiAgICAgIHRoaXMudGhlbWVMaXN0LmZvckVhY2godGhlbWUgPT4gew0KICAgICAgICB0aGlzLnJlbmRpdGlvbi50aGVtZXMucmVnaXN0ZXIodGhlbWUubmFtZSwgdGhlbWUuc3R5bGUpOw0KICAgICAgfSk7DQogICAgICB0aGlzLnJlbmRpdGlvbi50aGVtZXMuc2VsZWN0KGRlZmF1bHRUaGVtZSk7DQogICAgfSwNCiAgICBpbml0R2VzdHVyZSgpIHsNCiAgICAgIHRoaXMucmVuZGl0aW9uLm9uKCJ0b3VjaHN0YXJ0IiwgZXZlbnQgPT4gew0KICAgICAgICB0aGlzLnRvdWNoU3RhcnRYID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WDsNCiAgICAgICAgdGhpcy50b3VjaFN0YXJ0VGltZSA9IGV2ZW50LnRpbWVTdGFtcDsNCiAgICAgIH0pOw0KICAgICAgdGhpcy5yZW5kaXRpb24ub24oInRvdWNoZW5kIiwgZXZlbnQgPT4gew0KICAgICAgICBjb25zdCBvZmZzZXRYID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WCAtIHRoaXMudG91Y2hTdGFydFg7DQogICAgICAgIGNvbnN0IHRpbWUgPSBldmVudC50aW1lU3RhbXAgLSB0aGlzLnRvdWNoU3RhcnRUaW1lOw0KICAgICAgICAvL+agueaNruaJi+WKv+S6i+S7tuWunueOsOe/u+mhteWKn+iDvQ0KICAgICAgICBpZiAodGltZSA8IDUwMCAmJiBvZmZzZXRYID4gNDApIHsNCiAgICAgICAgICB0aGlzLnByZXZQYWdlKCk7DQogICAgICAgIH0gZWxzZSBpZiAodGltZSA8IDUwMCAmJiBvZmZzZXRYIDwgLTQwKSB7DQogICAgICAgICAgdGhpcy5uZXh0UGFnZSgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMudG9nZ2xlVGl0bGVBbmRNZW51KCk7DQogICAgICAgIH0NCiAgICAgICAgLy/nu4Tnu4fpu5jorqTkuovku7blkozlhpLms6ENCiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICB9KTsNCiAgICB9LA0KICAgIGluaXRSZW5kaXRpb24oKSB7DQogICAgICAvL+eUn+aIkFJlbmRpdGlvbuWvueixoQ0KICAgICAgdGhpcy5yZW5kaXRpb24gPSB0aGlzLmJvb2sucmVuZGVyVG8oInJlYWQiLCB7DQogICAgICAgIHdpZHRoOiB3aW5kb3cuaW5uZXJXaWR0aCwNCiAgICAgICAgaGVpZ2h0OiB3aW5kb3cuaW5uZXJIZWlnaHQsDQogICAgICAgIG1ldGhvZDogImRlZmF1bHQiDQogICAgICB9KTsNCiAgICAgIC8v6YCa6L+HUmVuZGl0aW9u5a+56LGh55qEZGlzcGxheeaWueazlea4suafk+eUteWtkOS5pg0KICAgICAgY29uc3QgbG9jYXRpb24gPSBnZXRMb2NhdGlvbih0aGlzLmZpbGVOYW1lKTsNCiAgICAgIHRoaXMuZGlzcGxheShsb2NhdGlvbiwgKCkgPT4gew0KICAgICAgICB0aGlzLmluaXRGb250U2l6ZSgpOw0KICAgICAgICB0aGlzLmluaXRGb250RmFtaWx5KCk7DQogICAgICAgIHRoaXMuaW5pdFRoZW1lKCk7DQogICAgICAgIHRoaXMuaW5pdEdsb2JhbFN0eWxlKCk7DQogICAgICB9KTsNCiAgICAgIHRoaXMucmVuZGl0aW9uLmhvb2tzLmNvbnRlbnQucmVnaXN0ZXIoY29udGVudHMgPT4gew0KICAgICAgICBQcm9taXNlLmFsbChbDQogICAgICAgICAgY29udGVudHMuYWRkU3R5bGVzaGVldCgNCiAgICAgICAgICAgIGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfUkVTX1VSTH0vZm9udHMvY2FiaW4uY3NzYA0KICAgICAgICAgICksDQogICAgICAgICAgY29udGVudHMuYWRkU3R5bGVzaGVldCgNCiAgICAgICAgICAgIGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfUkVTX1VSTH0vZm9udHMvbW9udHNlcnJhdC5jc3NgDQogICAgICAgICAgKSwNCiAgICAgICAgICBjb250ZW50cy5hZGRTdHlsZXNoZWV0KA0KICAgICAgICAgICAgYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9SRVNfVVJMfS9mb250cy90YW5nZXJpbmUuY3NzYA0KICAgICAgICAgICksDQogICAgICAgICAgY29udGVudHMuYWRkU3R5bGVzaGVldCgNCiAgICAgICAgICAgIGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfUkVTX1VSTH0vZm9udHMvZGF5c09uZS5jc3NgDQogICAgICAgICAgKQ0KICAgICAgICBdKS50aGVuKCgpID0+IHt9KTsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgcGFyc2VCb29rKCkgew0KICAgICAgLy/op6PmnpDnlLXlrZDkuabnmoTlsIHpnaINCiAgICAgIHRoaXMuYm9vay5sb2FkZWQuY292ZXIudGhlbihjb3ZlciA9PiB7DQogICAgICAgIHRoaXMuYm9vay5hcmNoaXZlLmNyZWF0ZVVybChjb3ZlcikudGhlbih1cmwgPT4gew0KICAgICAgICAgIHRoaXMuc2V0Q292ZXIodXJsKTsNCiAgICAgICAgfSk7DQogICAgICB9KTsNCiAgICAgIHRoaXMuYm9vay5sb2FkZWQubWV0YWRhdGEudGhlbihtZXRhZGF0YSA9PiB7DQogICAgICAgIHRoaXMuc2V0TWV0YWRhdGEobWV0YWRhdGEpOw0KICAgICAgfSk7DQogICAgICB0aGlzLmJvb2subG9hZGVkLm5hdmlnYXRpb24udGhlbihuYXYgPT4gew0KICAgICAgICAvL2NvbnNvbGUubG9nKG5hdikNCiAgICAgICAgLy/ojrflj5bnlLXlrZDkuabnmoTnm67lvZUNCiAgICAgICAgY29uc3QgbmF2SXRlbSA9IChmdW5jdGlvbiBmbGF0dGVuKGFycikgew0KICAgICAgICAgIHJldHVybiBbXS5jb25jYXQoLi4uYXJyLm1hcCh2ID0+IFt2LCAuLi5mbGF0dGVuKHYuc3ViaXRlbXMpXSkpOw0KICAgICAgICB9KShuYXYudG9jKTsNCiAgICAgICAgLy/lsIbmoJHnirbnm67lvZXnu5PmnoTovazljJbkuLrkuIDnu7TmlbDnu4QNCiAgICAgICAgZnVuY3Rpb24gZmluZChpdGVtLCB2ID0gMCkgew0KICAgICAgICAgIGNvbnN0IHBhcmVudCA9IG5hdkl0ZW0uZmlsdGVyKGl0ID0+IGl0LmlkID09PSBpdGVtLnBhcmVudClbMF07DQogICAgICAgICAgcmV0dXJuICFpdGVtLnBhcmVudCA/IHYgOiBwYXJlbnQgPyBmaW5kKHBhcmVudCwgKyt2KSA6IHY7DQogICAgICAgIH0NCg0KICAgICAgICBuYXZJdGVtLmZvckVhY2goaXRlbSA9PiB7DQogICAgICAgICAgaXRlbS5sZXZlbCA9IGZpbmQoaXRlbSk7DQogICAgICAgICAgaXRlbS50b3RhbCA9IDA7DQogICAgICAgICAgaXRlbS5wYWdlbGlzdCA9IFtdOw0KICAgICAgICAgIGlmIChpdGVtLmhyZWYubWF0Y2goL14oLiopXC5odG1sJC8pKSB7DQogICAgICAgICAgICBpdGVtLmlkaHJlZiA9IGl0ZW0uaHJlZi5tYXRjaCgvXiguKilcLmh0bWwkLylbMV07DQogICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmhyZWYubWF0Y2goL14oLiopXC54aHRtbCQvKSkgew0KICAgICAgICAgICAgaXRlbS5pZGhyZWYgPSBpdGVtLmhyZWYubWF0Y2goL14oLiopXC54aHRtbCQvKVsxXTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLnNldE5hdmlnYXRpb24obmF2SXRlbSk7DQogICAgICB9KTsNCiAgICB9LA0KICAgIGluaXRFcHViKHVybCkgew0KICAgICAgLy9jb25zdCB1cmwgPXByb2Nlc3MuZW52LlZVRV9BUFBfUkVTX1VSTCArICIvZXB1Yi8iICsgdGhpcy5maWxlTmFtZSArICIuZXB1YiI7DQogICAgICAvL+eUteWtkOS5pueahOino+aekOWSjOa4suafkw0KICAgICAgLy/nlJ/miJBFYm9va+WvueixoQ0KICAgICAgdGhpcy5ib29rID0gbmV3IEVwdWIodXJsKTsNCiAgICAgIHRoaXMuc2V0Q3VycmVudEJvb2sodGhpcy5ib29rKTsNCiAgICAgIHRoaXMuaW5pdFJlbmRpdGlvbigpOw0KICAgICAgdGhpcy5pbml0R2VzdHVyZSgpOw0KICAgICAgdGhpcy5wYXJzZUJvb2soKTsNCiAgICAgIHRoaXMuYm9vay5yZWFkeQ0KICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgLy/liIbpobUNCiAgICAgICAgICByZXR1cm4gdGhpcy5ib29rLmxvY2F0aW9ucy5nZW5lcmF0ZSgNCiAgICAgICAgICAgIDc1MCAqICh3aW5kb3cuaW5uZXJXaWR0aCAvIDM3NSkgKiAoZ2V0Rm9udFNpemUodGhpcy5maWxlTmFtZSkgLyAxNikNCiAgICAgICAgICApOw0KICAgICAgICB9KQ0KICAgICAgICAudGhlbihsb2NhdGlvbnMgPT4gew0KICAgICAgICAgIC8vY29uc29sZS5sb2cobG9jYXRpb25zKTsNCiAgICAgICAgICB0aGlzLnNldEJvb2tBdmFpbGFibGUodHJ1ZSk7DQogICAgICAgICAgdGhpcy5yZWZyZXNoTG9jYXRpb24oKTsNCiAgICAgICAgfSk7DQogICAgfQ0KICB9LA0KICBtb3VudGVkKCkgew0KICAgIGNvbnN0IGJvb2tzID0gdGhpcy4kcm91dGUucGFyYW1zLmZpbGVOYW1lLnNwbGl0KCJ8Iik7DQogICAgY29uc3QgZmlsZU5hbWUgPSBib29rc1sxXTsNCiAgICAvL+ivu+WPluemu+e6v+e8k+WtmA0KICAgIGdldExvY2FsRm9yYWdlKGZpbGVOYW1lLCAoZXJyLCBibG9iKSA9PiB7DQogICAgICBpZiAoIWVyciAmJiBibG9iKSB7DQogICAgICAgIC8v55S15a2Q5Lmm5pyJ56a757q/57yT5a2YDQogICAgICAgIC8vY29uc29sZS5sb2coIuaJvuWIsOemu+e6v+i1hOa6kCIpOw0KICAgICAgICB0aGlzLnNldGZpbGVOYW1lKGJvb2tzLmpvaW4oIi8iKSkudGhlbigoKSA9PiB7DQogICAgICAgICAgdGhpcy5pbml0RXB1YihibG9iKTsNCiAgICAgICAgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICAvL+iOt+WPluWcqOe6v+mdmeaAgei1hOa6kOeahOi3r+W+hA0KICAgICAgICB0aGlzLnNldGZpbGVOYW1lKGJvb2tzLmpvaW4oIi8iKSkudGhlbigoKSA9PiB7DQogICAgICAgICAgY29uc3QgdXJsID0gcHJvY2Vzcy5lbnYuVlVFX0FQUF9FUFVCX1VSTCArIHRoaXMuZmlsZU5hbWUgKyAiLmVwdWIiOw0KICAgICAgICAgIHRoaXMuaW5pdEVwdWIodXJsKTsNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfSk7DQogIH0NCn07DQo="},{"version":3,"sources":["EbookReader.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EbookReader.vue","sourceRoot":"src/components/Ebook","sourcesContent":["<template>\r\n  <div class=\"ebook-reader\">\r\n    <div\r\n      class=\"ebook-reader-mask\"\r\n      @touchmove=\"move\"\r\n      @touchend=\"moveEnd\"\r\n      @mousedown.left=\"onMouseEnter\"\r\n      @mousemove.left=\"onMouseMove\"\r\n      @mouseup.left=\"onMouseEnd\"\r\n      @click=\"onMaskClick\"\r\n    ></div>\r\n    <div id=\"read\" @click=\"toggleTitleAndMenu\"></div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport Epub from \"epubjs\";\r\nimport { ebookMixin } from \"../../utils/mixin\";\r\nimport {\r\n  getFontFamily,\r\n  saveFontFamily,\r\n  getFontSize,\r\n  saveFontSize,\r\n  getTheme,\r\n  saveTheme,\r\n  getLocation\r\n} from \"../../utils/localStorage\";\r\nimport { getLocalForage } from \"../../utils/localForage\";\r\nglobal.ePub = Epub;\r\nexport default {\r\n  mixins: [ebookMixin],\r\n  methods: {\r\n    move(e) {\r\n      let offsetY = 0;\r\n      if (this.firstOffsetY) {\r\n        offsetY = e.changedTouches[0].clientY - this.firstOffsetY;\r\n        this.setOffsetY(offsetY);\r\n      } else {\r\n        this.firstOffsetY = e.changedTouches[0].clientY;\r\n      }\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    },\r\n    moveEnd(e) {\r\n      this.setOffsetY(0);\r\n      this.firstOffsetY = 0;\r\n    },\r\n    onMouseEnter(e) {\r\n      this.mouseMove = 1;\r\n      this.mouseStartTime = e.timeStamp;\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    },\r\n    onMouseMove(e) {\r\n      if (this.mouseMove === 1) {\r\n        this.mouseMove = 2;\r\n      } else if (this.mouseMove === 2) {\r\n        let offsetY = 0;\r\n        if (this.firstOffsetY) {\r\n          offsetY = e.clientY - this.firstOffsetY;\r\n          this.setOffsetY(offsetY);\r\n        } else {\r\n          this.firstOffsetY = e.clientY;\r\n        }\r\n      }\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    },\r\n    onMouseEnd(e) {\r\n      if (this.mouseMove === 2) {\r\n        this.setOffsetY(0);\r\n        this.firstOffsetY = 0;\r\n        this.mouseMove = 3;\r\n      }\r\n      this.mouseEndTime = e.timeStamp;\r\n      const time = this.mouseEndTime - this.mouseStartTime;\r\n      if (time < 200) {\r\n        this.mouseMove = 1;\r\n      }\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    },\r\n    onMaskClick(e) {\r\n      const offsetX = e.offsetX;\r\n      const width = window.innerWidth;\r\n      if (offsetX > 0 && offsetX < width * 0.3) {\r\n        this.prevPage();\r\n      } else if (offsetX > 0 && offsetX > width * 0.7) {\r\n        this.nextPage();\r\n      } else {\r\n        this.toggleTitleAndMenu();\r\n      }\r\n    },\r\n    prevPage() {\r\n      //调用Rendition的prev方法返回上一页\r\n      if (this.rendition) {\r\n        this.rendition.prev().then(() => {\r\n          this.refreshLocation();\r\n        });\r\n      }\r\n      this.hideTitleAndMenu();\r\n    },\r\n    nextPage() {\r\n      //调用Rendition的next方法返回上一页\r\n      if (this.rendition) {\r\n        this.rendition.next().then(() => {\r\n          this.refreshLocation();\r\n        });\r\n      }\r\n      this.hideTitleAndMenu();\r\n    },\r\n    toggleTitleAndMenu() {\r\n      if (this.menuVisible) {\r\n        this.setSettingVisible(-1);\r\n        this.setFontFamilyVisible(false);\r\n      }\r\n      this.setMenuVisible(!this.menuVisible);\r\n    },\r\n\r\n    initFontSize() {\r\n      //读取localStorage中的FontSize\r\n      let fontSize = getFontSize(this.fileName);\r\n      if (fontSize) {\r\n        this.rendition.themes.fontSize(fontSize);\r\n        this.setDefaultFontSize(fontSize);\r\n      } else {\r\n        saveFontSize(this.fileName, this.defaultFontSize);\r\n      }\r\n    },\r\n    initFontFamily() {\r\n      //读取localStorage中的Font\r\n      let font = getFontFamily(this.fileName);\r\n      if (font) {\r\n        this.rendition.themes.font(font);\r\n        this.setDefaultFontFamily(font);\r\n      } else {\r\n        saveFontFamily(this.fileName, this.defaultFontFamily);\r\n      }\r\n    },\r\n    initTheme() {\r\n      //初始化主题\r\n      let defaultTheme = getTheme(this.fileName);\r\n      if (!defaultTheme) {\r\n        defaultTheme = this.themeList[0].name;\r\n        saveTheme(this.fileName, defaultTheme);\r\n      }\r\n      this.setDefaultTheme(defaultTheme);\r\n      this.themeList.forEach(theme => {\r\n        this.rendition.themes.register(theme.name, theme.style);\r\n      });\r\n      this.rendition.themes.select(defaultTheme);\r\n    },\r\n    initGesture() {\r\n      this.rendition.on(\"touchstart\", event => {\r\n        this.touchStartX = event.changedTouches[0].clientX;\r\n        this.touchStartTime = event.timeStamp;\r\n      });\r\n      this.rendition.on(\"touchend\", event => {\r\n        const offsetX = event.changedTouches[0].clientX - this.touchStartX;\r\n        const time = event.timeStamp - this.touchStartTime;\r\n        //根据手势事件实现翻页功能\r\n        if (time < 500 && offsetX > 40) {\r\n          this.prevPage();\r\n        } else if (time < 500 && offsetX < -40) {\r\n          this.nextPage();\r\n        } else {\r\n          this.toggleTitleAndMenu();\r\n        }\r\n        //组织默认事件和冒泡\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n      });\r\n    },\r\n    initRendition() {\r\n      //生成Rendition对象\r\n      this.rendition = this.book.renderTo(\"read\", {\r\n        width: window.innerWidth,\r\n        height: window.innerHeight,\r\n        method: \"default\"\r\n      });\r\n      //通过Rendition对象的display方法渲染电子书\r\n      const location = getLocation(this.fileName);\r\n      this.display(location, () => {\r\n        this.initFontSize();\r\n        this.initFontFamily();\r\n        this.initTheme();\r\n        this.initGlobalStyle();\r\n      });\r\n      this.rendition.hooks.content.register(contents => {\r\n        Promise.all([\r\n          contents.addStylesheet(\r\n            `${process.env.VUE_APP_RES_URL}/fonts/cabin.css`\r\n          ),\r\n          contents.addStylesheet(\r\n            `${process.env.VUE_APP_RES_URL}/fonts/montserrat.css`\r\n          ),\r\n          contents.addStylesheet(\r\n            `${process.env.VUE_APP_RES_URL}/fonts/tangerine.css`\r\n          ),\r\n          contents.addStylesheet(\r\n            `${process.env.VUE_APP_RES_URL}/fonts/daysOne.css`\r\n          )\r\n        ]).then(() => {});\r\n      });\r\n    },\r\n    parseBook() {\r\n      //解析电子书的封面\r\n      this.book.loaded.cover.then(cover => {\r\n        this.book.archive.createUrl(cover).then(url => {\r\n          this.setCover(url);\r\n        });\r\n      });\r\n      this.book.loaded.metadata.then(metadata => {\r\n        this.setMetadata(metadata);\r\n      });\r\n      this.book.loaded.navigation.then(nav => {\r\n        //console.log(nav)\r\n        //获取电子书的目录\r\n        const navItem = (function flatten(arr) {\r\n          return [].concat(...arr.map(v => [v, ...flatten(v.subitems)]));\r\n        })(nav.toc);\r\n        //将树状目录结构转化为一维数组\r\n        function find(item, v = 0) {\r\n          const parent = navItem.filter(it => it.id === item.parent)[0];\r\n          return !item.parent ? v : parent ? find(parent, ++v) : v;\r\n        }\r\n\r\n        navItem.forEach(item => {\r\n          item.level = find(item);\r\n          item.total = 0;\r\n          item.pagelist = [];\r\n          if (item.href.match(/^(.*)\\.html$/)) {\r\n            item.idhref = item.href.match(/^(.*)\\.html$/)[1];\r\n          } else if (item.href.match(/^(.*)\\.xhtml$/)) {\r\n            item.idhref = item.href.match(/^(.*)\\.xhtml$/)[1];\r\n          }\r\n        });\r\n        this.setNavigation(navItem);\r\n      });\r\n    },\r\n    initEpub(url) {\r\n      //const url =process.env.VUE_APP_RES_URL + \"/epub/\" + this.fileName + \".epub\";\r\n      //电子书的解析和渲染\r\n      //生成Ebook对象\r\n      this.book = new Epub(url);\r\n      this.setCurrentBook(this.book);\r\n      this.initRendition();\r\n      this.initGesture();\r\n      this.parseBook();\r\n      this.book.ready\r\n        .then(() => {\r\n          //分页\r\n          return this.book.locations.generate(\r\n            750 * (window.innerWidth / 375) * (getFontSize(this.fileName) / 16)\r\n          );\r\n        })\r\n        .then(locations => {\r\n          //console.log(locations);\r\n          this.setBookAvailable(true);\r\n          this.refreshLocation();\r\n        });\r\n    }\r\n  },\r\n  mounted() {\r\n    const books = this.$route.params.fileName.split(\"|\");\r\n    const fileName = books[1];\r\n    //读取离线缓存\r\n    getLocalForage(fileName, (err, blob) => {\r\n      if (!err && blob) {\r\n        //电子书有离线缓存\r\n        //console.log(\"找到离线资源\");\r\n        this.setfileName(books.join(\"/\")).then(() => {\r\n          this.initEpub(blob);\r\n        });\r\n      } else {\r\n        //获取在线静态资源的路径\r\n        this.setfileName(books.join(\"/\")).then(() => {\r\n          const url = process.env.VUE_APP_EPUB_URL + this.fileName + \".epub\";\r\n          this.initEpub(url);\r\n        });\r\n      }\r\n    });\r\n  }\r\n};\r\n</script>\r\n<style lang=\"scss\" rel=\"stylesheet/scss\" scoped>\r\n@import \"../../assets/styles/global\";\r\n\r\n.ebook-reader {\r\n  width: 100%;\r\n  height: 100%;\r\n  overflow: hidden;\r\n  .ebook-reader-mask {\r\n    position: absolute;\r\n    z-index: 100;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n}\r\n</style>\r\n"]}]}