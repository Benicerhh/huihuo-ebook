{"remainingRequest":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\components\\Ebook\\EbookBookmark.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\src\\components\\Ebook\\EbookBookmark.vue","mtime":1588150554609},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\JodPreparation\\Practice\\项目\\huihuo-ebook\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHJlYWxQeCB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWxzJwppbXBvcnQgQm9va21hcmsgZnJvbSAnLi9Cb29rbWFyaycKaW1wb3J0IHsgZWJvb2tNaXhpbiB9IGZyb20gJy4uLy4uL3V0aWxzL21peGluJwppbXBvcnQgeyBnZXRCb29rbWFyaywgc2F2ZUJvb2ttYXJrIH0gZnJvbSAnLi4vLi4vdXRpbHMvbG9jYWxTdG9yYWdlJwoKY29uc3QgQkxVRSA9ICcjMzQ2Y2JjJwpjb25zdCBXSElURSA9ICcjZmZmJwpleHBvcnQgZGVmYXVsdCB7CiAgbWl4aW5zOiBbZWJvb2tNaXhpbl0sCiAgY29tcG9uZW50czogewogICAgQm9va21hcmsKICB9LAogIGNvbXB1dGVkOiB7CiAgICBoZWlnaHQoKSB7CiAgICAgIHJldHVybiByZWFsUHgoMzUpCiAgICB9LAogICAgdGhyZXNob2xkKCkgewogICAgICByZXR1cm4gcmVhbFB4KDU1KQogICAgfSwKICAgIGZpeGVkU3R5bGUoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgcG9zaXRpb246ICdmaXhlZCcsCiAgICAgICAgdG9wOiAwLAogICAgICAgIHJpZ2h0OiBgJHsod2luZG93LmlubmVyV2lkdGggLSB0aGlzLiRyZWZzLmJvb2ttYXJrLmNsaWVudFdpZHRoKSAvIDJ9cHhgCiAgICAgIH0KICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBvZmZzZXRZKHYpIHsKICAgICAgaWYgKCF0aGlzLmJvb2tBdmFpbGFibGUgfHwgdGhpcy5tZW51VmlzaWJsZSB8fCB0aGlzLnNldHRpbmdWaXNpYmxlID49IDApIHsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICBpZiAodiA+PSB0aGlzLmhlaWdodCAmJiB2IDwgdGhpcy50aHJlc2hvbGQpIHsKICAgICAgICB0aGlzLmJlZm9yZVRocmVzaG9sZCh2KQogICAgICB9IGVsc2UgaWYgKHYgPj0gdGhpcy50aHJlc2hvbGQpIHsKICAgICAgICB0aGlzLmFmdGVyVGhyZXNob2xkKHYpCiAgICAgIH0gZWxzZSBpZiAodiA+IDAgJiYgdiA8IHRoaXMuaGVpZ2h0KSB7CiAgICAgICAgdGhpcy5iZWZvcmVIZWlnaHQoKQogICAgICB9IGVsc2UgaWYgKHYgPT09IDApIHsKICAgICAgICB0aGlzLnJlc3RvcmUoKQogICAgICB9CiAgICB9LAogICAgaXNCb29rbWFyayhpc0Jvb2ttYXJrKSB7CiAgICAgIHRoaXMuaXNGaXhlZCA9IGlzQm9va21hcmsKICAgICAgaWYgKGlzQm9va21hcmspIHsKICAgICAgICB0aGlzLmNvbG9yID0gQkxVRQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY29sb3IgPSBXSElURQogICAgICB9CiAgICB9CiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdGV4dDogJycsCiAgICAgIGNvbG9yOiBXSElURSwKICAgICAgaXNGaXhlZDogZmFsc2UKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGFkZEJvb2ttYXJrKCkgewogICAgICB0aGlzLmJvb2ttYXJrID0gZ2V0Qm9va21hcmsodGhpcy5maWxlbmFtZSkKICAgICAgaWYgKCF0aGlzLmJvb2ttYXJrKSB7CiAgICAgICAgdGhpcy5ib29rbWFyayA9IFtdCiAgICAgIH0KICAgICAgY29uc3QgY3VycmVudExvY2F0aW9uID0gdGhpcy5jdXJyZW50Qm9vay5yZW5kaXRpb24uY3VycmVudExvY2F0aW9uKCkKICAgICAgY29uc3QgY2ZpYmFzZSA9IGN1cnJlbnRMb2NhdGlvbi5zdGFydC5jZmkucmVwbGFjZSgvIS4qLywgJycpCiAgICAgIGNvbnN0IGNmaXN0YXJ0ID0gY3VycmVudExvY2F0aW9uLnN0YXJ0LmNmaQogICAgICAgIC5yZXBsYWNlKC8uKiEvLCAnJykKICAgICAgICAucmVwbGFjZSgvXCkkLywgJycpCiAgICAgIGNvbnN0IGNmaWVuZCA9IGN1cnJlbnRMb2NhdGlvbi5lbmQuY2ZpCiAgICAgICAgLnJlcGxhY2UoLy4qIS8sICcnKQogICAgICAgIC5yZXBsYWNlKC9cKSQvLCAnJykKICAgICAgY29uc3QgY2ZpcmFuZ2UgPSBgJHtjZmliYXNlfSEsJHtjZmlzdGFydH0sJHtjZmllbmR9KWAKICAgICAgdGhpcy5jdXJyZW50Qm9vay5nZXRSYW5nZShjZmlyYW5nZSkudGhlbihyYW5nZSA9PiB7CiAgICAgICAgLy/ljrvmjonnqbrmoLwKICAgICAgICBjb25zdCB0ZXh0ID0gcmFuZ2UudG9TdHJpbmcoKS5yZXBsYWNlKC9cc1xzL2csICcnKQogICAgICAgIC8v5a2Y5YKo5Lmm562+5L+h5oGvCiAgICAgICAgaWYgKCEoY3VycmVudExvY2F0aW9uLnN0YXJ0LmNmaSBpbiB0aGlzLmJvb2ttYXJrKSkgewogICAgICAgICAgLy/kuabnrb7ljrvph40KICAgICAgICAgIHRoaXMuYm9va21hcmsucHVzaCh7CiAgICAgICAgICAgIGNmaTogY3VycmVudExvY2F0aW9uLnN0YXJ0LmNmaSwKICAgICAgICAgICAgdGV4dDogdGV4dAogICAgICAgICAgfSkKICAgICAgICAgIHNhdmVCb29rbWFyayh0aGlzLmZpbGVuYW1lLCB0aGlzLmJvb2ttYXJrKQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICByZW1vdmVCb29rbWFyaygpIHsKICAgICAgY29uc3QgY3VycmVudExvY2F0aW9uID0gdGhpcy5jdXJyZW50Qm9vay5yZW5kaXRpb24uY3VycmVudExvY2F0aW9uKCkKICAgICAgY29uc3QgY2ZpID0gY3VycmVudExvY2F0aW9uLnN0YXJ0LmNmaQogICAgICB0aGlzLmJvb2ttYXJrID0gZ2V0Qm9va21hcmsodGhpcy5maWxlbmFtZSkKICAgICAgaWYgKHRoaXMuYm9va21hcmspIHsKICAgICAgICBzYXZlQm9va21hcmsoCiAgICAgICAgICB0aGlzLmZpbGVuYW1lLAogICAgICAgICAgdGhpcy5ib29rbWFyay5maWx0ZXIoaXRlbSA9PiBpdGVtLmNmaSAhPT0gY2ZpKQogICAgICAgICkKICAgICAgICB0aGlzLnNldElzQm9va21hcmsoZmFsc2UpCiAgICAgIH0KICAgIH0sCiAgICByZXN0b3JlKCkgewogICAgICAvLyDnirbmgIE077ya5b2S5L2NCiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHRoaXMuJHJlZnMuYm9va21hcmsuc3R5bGUudG9wID0gYCR7LXRoaXMuaGVpZ2h0fXB4YAogICAgICAgIHRoaXMuJHJlZnMuaWNvbkRvd24uc3R5bGUudHJhbnNmb3JtID0gJ3JvdGF0ZSgwZGVnKScKICAgICAgfSwgMjAwKQogICAgICBpZiAodGhpcy5pc0ZpeGVkKSB7CiAgICAgICAgdGhpcy5zZXRJc0Jvb2ttYXJrKHRydWUpCiAgICAgICAgdGhpcy5hZGRCb29rbWFyaygpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZXRJc0Jvb2ttYXJrKGZhbHNlKQogICAgICAgIHRoaXMucmVtb3ZlQm9va21hcmsoKQogICAgICB9CiAgICB9LAogICAgYmVmb3JlSGVpZ2h0KCkgewogICAgICAvLyDnirbmgIEx77ya5pyq6LaF6L+H5Lmm562+55qE6auY5bqmCiAgICAgIGlmICh0aGlzLmlzQm9va21hcmspIHsKICAgICAgICB0aGlzLnRleHQgPSB0aGlzLiR0KCdib29rLnB1bGxkb3duRGVsZXRlTWFyaycpCiAgICAgICAgdGhpcy5jb2xvciA9IEJMVUUKICAgICAgICB0aGlzLmlzRml4ZWQgPSB0cnVlCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50ZXh0ID0gdGhpcy4kdCgnYm9vay5wdWxsZG93bkFkZE1hcmsnKQogICAgICAgIHRoaXMuY29sb3IgPSBXSElURQogICAgICAgIHRoaXMuaXNGaXhlZCA9IGZhbHNlCiAgICAgIH0KICAgIH0sCiAgICBiZWZvcmVUaHJlc2hvbGQodikgewogICAgICAvLyDnirbmgIEy77ya5pyq5Yiw6L6+6Zu255WM54q25oCBCiAgICAgIHRoaXMuJHJlZnMuYm9va21hcmsuc3R5bGUudG9wID0gYCR7LXZ9cHhgCiAgICAgIHRoaXMuYmVmb3JlSGVpZ2h0KCkKICAgICAgY29uc3QgaWNvbkRvd24gPSB0aGlzLiRyZWZzLmljb25Eb3duCiAgICAgIGlmIChpY29uRG93bi5zdHlsZS50cmFuc2Zvcm0gPT09ICdyb3RhdGUoMTgwZGVnKScpIHsKICAgICAgICBpY29uRG93bi5zdHlsZS50cmFuc2Zvcm0gPSAncm90YXRlKDBkZWcpJwogICAgICB9CiAgICB9LAogICAgYWZ0ZXJUaHJlc2hvbGQodikgewogICAgICAvLyDnirbmgIEz77ya6LaF6LaK6Zu255WM54q25oCBCiAgICAgIHRoaXMuJHJlZnMuYm9va21hcmsuc3R5bGUudG9wID0gYCR7LXZ9cHhgCiAgICAgIGlmICh0aGlzLmlzQm9va21hcmspIHsKICAgICAgICB0aGlzLnRleHQgPSB0aGlzLiR0KCdib29rLnJlbGVhc2VEZWxldGVNYXJrJykKICAgICAgICB0aGlzLmNvbG9yID0gV0hJVEUKICAgICAgICB0aGlzLmlzRml4ZWQgPSBmYWxzZQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudGV4dCA9IHRoaXMuJHQoJ2Jvb2sucmVsZWFzZUFkZE1hcmsnKQogICAgICAgIHRoaXMuY29sb3IgPSBCTFVFCiAgICAgICAgdGhpcy5pc0ZpeGVkID0gdHJ1ZQogICAgICB9CiAgICAgIGNvbnN0IGljb25Eb3duID0gdGhpcy4kcmVmcy5pY29uRG93bgogICAgICBpZiAoCiAgICAgICAgaWNvbkRvd24uc3R5bGUudHJhbnNmb3JtID09PSAnJyB8fAogICAgICAgIGljb25Eb3duLnN0eWxlLnRyYW5zZm9ybSA9PT0gJ3JvdGF0ZSgwZGVnKScKICAgICAgKSB7CiAgICAgICAgaWNvbkRvd24uc3R5bGUudHJhbnNmb3JtID0gJ3JvdGF0ZSgxODBkZWcpJwogICAgICB9CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["EbookBookmark.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;AAeA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EbookBookmark.vue","sourceRoot":"src/components/Ebook","sourcesContent":["<template>\r\n  <div class=\"ebook-bookmark\" ref=\"bookmark\">\r\n    <div class=\"ebook-bookmark-text-wrapper\">\r\n      <div class=\"ebook-bookmark-down-wrapper\" ref=\"iconDown\">\r\n        <span class=\"icon-down\"></span>\r\n      </div>\r\n      <div class=\"ebook-bookmark-text\">{{text}}</div>\r\n    </div>\r\n    <div class=\"ebook-bookmark-icon-wrapper\" :style=\"isFixed ? fixedStyle : {}\">\r\n      <bookmark :color=\"color\" :width=\"15\" :height=\"35\"></bookmark>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import { realPx } from '../../utils/utils'\r\n  import Bookmark from './Bookmark'\r\n  import { ebookMixin } from '../../utils/mixin'\r\n  import { getBookmark, saveBookmark } from '../../utils/localStorage'\r\n\r\n  const BLUE = '#346cbc'\r\n  const WHITE = '#fff'\r\n  export default {\r\n    mixins: [ebookMixin],\r\n    components: {\r\n      Bookmark\r\n    },\r\n    computed: {\r\n      height() {\r\n        return realPx(35)\r\n      },\r\n      threshold() {\r\n        return realPx(55)\r\n      },\r\n      fixedStyle() {\r\n        return {\r\n          position: 'fixed',\r\n          top: 0,\r\n          right: `${(window.innerWidth - this.$refs.bookmark.clientWidth) / 2}px`\r\n        }\r\n      }\r\n    },\r\n    watch: {\r\n      offsetY(v) {\r\n        if (!this.bookAvailable || this.menuVisible || this.settingVisible >= 0) {\r\n          return\r\n        }\r\n        if (v >= this.height && v < this.threshold) {\r\n          this.beforeThreshold(v)\r\n        } else if (v >= this.threshold) {\r\n          this.afterThreshold(v)\r\n        } else if (v > 0 && v < this.height) {\r\n          this.beforeHeight()\r\n        } else if (v === 0) {\r\n          this.restore()\r\n        }\r\n      },\r\n      isBookmark(isBookmark) {\r\n        this.isFixed = isBookmark\r\n        if (isBookmark) {\r\n          this.color = BLUE\r\n        } else {\r\n          this.color = WHITE\r\n        }\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        text: '',\r\n        color: WHITE,\r\n        isFixed: false\r\n      }\r\n    },\r\n    methods: {\r\n      addBookmark() {\r\n        this.bookmark = getBookmark(this.filename)\r\n        if (!this.bookmark) {\r\n          this.bookmark = []\r\n        }\r\n        const currentLocation = this.currentBook.rendition.currentLocation()\r\n        const cfibase = currentLocation.start.cfi.replace(/!.*/, '')\r\n        const cfistart = currentLocation.start.cfi\r\n          .replace(/.*!/, '')\r\n          .replace(/\\)$/, '')\r\n        const cfiend = currentLocation.end.cfi\r\n          .replace(/.*!/, '')\r\n          .replace(/\\)$/, '')\r\n        const cfirange = `${cfibase}!,${cfistart},${cfiend})`\r\n        this.currentBook.getRange(cfirange).then(range => {\r\n          //去掉空格\r\n          const text = range.toString().replace(/\\s\\s/g, '')\r\n          //存储书签信息\r\n          if (!(currentLocation.start.cfi in this.bookmark)) {\r\n            //书签去重\r\n            this.bookmark.push({\r\n              cfi: currentLocation.start.cfi,\r\n              text: text\r\n            })\r\n            saveBookmark(this.filename, this.bookmark)\r\n          }\r\n        })\r\n      },\r\n      removeBookmark() {\r\n        const currentLocation = this.currentBook.rendition.currentLocation()\r\n        const cfi = currentLocation.start.cfi\r\n        this.bookmark = getBookmark(this.filename)\r\n        if (this.bookmark) {\r\n          saveBookmark(\r\n            this.filename,\r\n            this.bookmark.filter(item => item.cfi !== cfi)\r\n          )\r\n          this.setIsBookmark(false)\r\n        }\r\n      },\r\n      restore() {\r\n        // 状态4：归位\r\n        setTimeout(() => {\r\n          this.$refs.bookmark.style.top = `${-this.height}px`\r\n          this.$refs.iconDown.style.transform = 'rotate(0deg)'\r\n        }, 200)\r\n        if (this.isFixed) {\r\n          this.setIsBookmark(true)\r\n          this.addBookmark()\r\n        } else {\r\n          this.setIsBookmark(false)\r\n          this.removeBookmark()\r\n        }\r\n      },\r\n      beforeHeight() {\r\n        // 状态1：未超过书签的高度\r\n        if (this.isBookmark) {\r\n          this.text = this.$t('book.pulldownDeleteMark')\r\n          this.color = BLUE\r\n          this.isFixed = true\r\n        } else {\r\n          this.text = this.$t('book.pulldownAddMark')\r\n          this.color = WHITE\r\n          this.isFixed = false\r\n        }\r\n      },\r\n      beforeThreshold(v) {\r\n        // 状态2：未到达零界状态\r\n        this.$refs.bookmark.style.top = `${-v}px`\r\n        this.beforeHeight()\r\n        const iconDown = this.$refs.iconDown\r\n        if (iconDown.style.transform === 'rotate(180deg)') {\r\n          iconDown.style.transform = 'rotate(0deg)'\r\n        }\r\n      },\r\n      afterThreshold(v) {\r\n        // 状态3：超越零界状态\r\n        this.$refs.bookmark.style.top = `${-v}px`\r\n        if (this.isBookmark) {\r\n          this.text = this.$t('book.releaseDeleteMark')\r\n          this.color = WHITE\r\n          this.isFixed = false\r\n        } else {\r\n          this.text = this.$t('book.releaseAddMark')\r\n          this.color = BLUE\r\n          this.isFixed = true\r\n        }\r\n        const iconDown = this.$refs.iconDown\r\n        if (\r\n          iconDown.style.transform === '' ||\r\n          iconDown.style.transform === 'rotate(0deg)'\r\n        ) {\r\n          iconDown.style.transform = 'rotate(180deg)'\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\" rel=\"stylesheet/scss\" scoped>\r\n  @import '../../assets/styles/global';\r\n\r\n  .ebook-bookmark {\r\n    position: absolute;\r\n    top: px2rem(-35);\r\n    left: 0;\r\n    z-index: 200;\r\n    width: 100%;\r\n    height: px2rem(35);\r\n    .ebook-bookmark-text-wrapper {\r\n      position: absolute;\r\n      right: px2rem(45);\r\n      bottom: 0;\r\n      display: flex;\r\n      .ebook-bookmark-down-wrapper {\r\n        font-size: px2rem(14);\r\n        color: white;\r\n        transition: all 0.2s linear;\r\n        @include center;\r\n      }\r\n      .ebook-bookmark-text {\r\n        font-size: px2rem(14);\r\n        color: white;\r\n      }\r\n    }\r\n    .ebook-bookmark-icon-wrapper {\r\n      position: absolute;\r\n      right: 0;\r\n      bottom: 0;\r\n      margin-right: px2rem(15);\r\n    }\r\n  }\r\n</style>"]}]}